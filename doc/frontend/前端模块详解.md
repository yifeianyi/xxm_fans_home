# XXM Fans Home 前端模块详解

本文档详细介绍 XXM Fans Home 项目前端各功能模块的详细设计、组件结构和数据流。

---

## 目录

1. [架构概览](#一架构概览)
2. [领域层 (Domain)](#二领域层-domain)
3. [基础设施层 (Infrastructure)](#三基础设施层-infrastructure)
4. [表现层 (Presentation)](#四表现层-presentation)
5. [共享层 (Shared)](#五共享层-shared)
6. [页面模块详解](#六页面模块详解)
7. [数据流总览](#七数据流总览)

---

## 一、架构概览

### 1.1 DDD 分层架构

```
┌─────────────────────────────────────────────────────────────────┐
│                      前端 DDD 架构                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    表现层 (Presentation)                 │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │   │
│  │  │  Pages   │ │Components│ │  Hooks   │ │  Assets  │  │   │
│  │  │  页面    │ │  组件    │ │  钩子    │ │  资源    │  │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │   │
│  └────────────────────────┬────────────────────────────────┘   │
│                           │ 依赖抽象（接口）                      │
│                           ▼                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    领域层 (Domain)                       │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │   │
│  │  │  Types   │ │Interfaces│ │ Constants│ │ Entities │  │   │
│  │  │  类型    │ │  接口    │ │  常量    │ │  实体    │  │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │   │
│  └────────────────────────┬────────────────────────────────┘   │
│                           │ 实现抽象                             │
│                           ▼                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 基础设施层 (Infrastructure)              │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │   │
│  │  │  API     │ │  Config  │ │  Hooks   │ │Providers │  │   │
│  │  │ 服务实现 │ │  配置    │ │基础设施  │ │ 提供者   │  │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                           │                                    │
│                           ▼                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    共享层 (Shared)                       │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │   │
│  │  │  Utils   │ │  Hooks   │ │ Services │ │  Types   │  │   │
│  │  │ 工具函数 │ │ 通用钩子 │ │ 共享服务 │ │ 共享类型 │  │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 技术栈

| 层级 | 技术 | 版本 | 用途 |
|------|------|------|------|
| 框架 | React | 19.2.3 | UI 组件库 |
| 语言 | TypeScript | 5.8.2 | 类型安全 |
| 构建 | Vite | 6.2.0 | 开发服务器和打包 |
| 路由 | React Router DOM | 7.12.0 | 客户端路由 |
| 数据获取 | SWR | 2.4.0 | 数据缓存和重新验证 |
| 样式 | Tailwind CSS | 4.1.18 | 原子化 CSS |
| 图标 | Lucide React | 0.562.0 | 图标库 |
| SEO | React Helmet | - | 页面头部管理 |

### 1.3 项目结构

```
xxm_fans_frontend/
├── domain/                     # 领域层
│   ├── types.ts               # 领域模型类型
│   ├── api/
│   │   ├── ISongService.ts    # 歌曲服务接口
│   │   └── ISubmissionService.ts # 投稿服务接口
│   └── constants.ts           # 领域常量
│
├── infrastructure/             # 基础设施层
│   ├── api/                   # API 服务实现
│   │   ├── RealSongService.ts
│   │   ├── RealGalleryService.ts
│   │   ├── RealSiteSettingsService.ts
│   │   ├── RealDataAnalyticsService.ts
│   │   ├── RealSubmissionService.ts
│   │   └── apiTypes.ts        # API 类型定义
│   ├── config/                # 配置管理
│   │   ├── config.ts
│   │   ├── constants.ts
│   │   └── routes.ts
│   ├── hooks/                 # 基础设施 Hooks
│   │   ├── useData.ts         # SWR 数据获取封装
│   │   └── useSWRConfig.ts    # SWR 配置
│   └── components/            # 基础设施组件
│       ├── SEO.tsx            # SEO 组件
│       └── SWRProvider.tsx    # SWR 全局配置
│
├── presentation/              # 表现层
│   ├── components/            # 组件
│   │   ├── common/            # 通用组件
│   │   │   ├── ErrorBoundary.tsx
│   │   │   ├── Loading.tsx
│   │   │   ├── LazyImage.tsx
│   │   │   ├── VideoModal.tsx
│   │   │   ├── MusicPlayer.tsx
│   │   │   ├── MysteryBoxModal.tsx
│   │   │   └── SmartPlayController.tsx
│   │   ├── features/          # 功能组件
│   │   │   ├── SongTable.tsx
│   │   │   ├── RecordList.tsx
│   │   │   ├── RankingChart.tsx
│   │   │   ├── OriginalsList.tsx
│   │   │   └── TimelineChart.tsx
│   │   └── layout/            # 布局组件
│   │       ├── Navbar.tsx
│   │       └── Footer.tsx
│   ├── pages/                 # 页面组件
│   │   ├── HomePage.tsx
│   │   ├── SongsPage.tsx
│   │   ├── FansDIYPage.tsx
│   │   ├── GalleryPage.tsx
│   │   ├── LivestreamPage.tsx
│   │   ├── DataAnalysisPage.tsx
│   │   ├── OriginalsPage.tsx
│   │   ├── AboutPage.tsx
│   │   └── ContactPage.tsx
│   └── hooks/                 # 表现层 Hooks
│       └── useSongData.ts
│
├── shared/                    # 共享层
│   ├── hooks/                 # 通用 Hooks
│   │   ├── useClickOutside.ts
│   │   ├── useDebounce.ts
│   │   ├── useLocalStorage.ts
│   │   ├── useMediaQuery.ts
│   │   └── useScrollPosition.ts
│   ├── services/              # 共享服务
│   │   └── VideoPlayerService.ts
│   └── utils/                 # 工具函数
│       ├── device.ts
│       ├── videoUtils.ts
│       └── seoUtils.ts
│
├── App.tsx                    # 应用入口
├── index.tsx                  # 渲染入口
└── index.css                  # 全局样式
```

---

## 二、领域层 (Domain)

### 2.1 核心领域模型

#### 2.1.1 Song（歌曲）

```typescript
interface Song {
    id: string;
    name: string;                // 歌曲名称
    originalArtist: string;      // 原唱歌手
    genres: string[];            // 曲风列表
    languages: string[];         // 语言列表
    firstPerformance: string;    // 首次演唱时间
    lastPerformance: string;     // 最近演唱时间
    performanceCount: number;    // 演唱次数
    tags: string[];              // 标签列表
}
```

#### 2.1.2 SongRecord（演唱记录）

```typescript
interface SongRecord {
    id: string;
    songId: string;
    songName: string;            // 歌曲名称
    date: string;                // 演唱日期
    cover: string;               // 封面 URL
    coverThumbnailUrl?: string;  // 缩略图 URL
    note: string;                // 备注
    videoUrl: string;            // 视频链接
}
```

#### 2.1.3 Gallery（图集）

```typescript
interface Gallery {
    id: string;
    title: string;               // 标题
    description: string;         // 描述
    coverUrl: string;            // 封面 URL
    coverThumbnailUrl?: string;  // 缩略图 URL
    level: number;               // 层级深度
    imageCount: number;          // 图片数量
    folderPath: string;          // 文件夹路径
    tags: string[];              // 标签
    isLeaf: boolean;             // 是否为叶子节点
    children?: Gallery[];        // 子图集
    breadcrumbs?: Breadcrumb[];  // 面包屑导航
}
```

#### 2.1.4 Livestream（直播）

```typescript
interface Livestream {
    id: string;
    date: string;                // 直播日期
    title?: string;              // 直播标题
    summary?: string;            // 直播简介
    viewCount?: string;          // 观看人数
    danmakuCount?: string;       // 弹幕数
    startTime?: string;          // 开播时间
    endTime?: string;            // 下播时间
    duration?: string;           // 直播时长
    bvid?: string;               // B站 BV 号
    parts?: number;              // 视频分段数
    coverUrl?: string;           // 封面 URL
    recordings?: LivestreamRecording[];  // 分段视频
    songCuts?: SongCut[];        // 当日歌切
    screenshots?: Screenshot[];  // 直播截图
    danmakuCloudUrl?: string;    // 弹幕云图
}
```

#### 2.1.5 FanWork（粉丝二创作品）

```typescript
interface FanWork {
    id: string;
    title: string;               // 作品标题
    author: string;              // 作者
    cover: string;               // 封面 URL
    coverThumbnailUrl?: string;  // 缩略图 URL
    videoUrl: string;            // 视频链接
    note: string;                // 备注
    collectionId: string;        // 所属合集 ID
    position: number;            // 排序位置
}
```

### 2.2 领域模型关系图

```
┌─────────────────────────────────────────────────────────────────┐
│                      领域模型关系图                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────────┐                                              │
│   │     Song     │                                              │
│   │    歌曲信息   │                                              │
│   └──────┬───────┘                                              │
│          │ 1:N                                                  │
│          │                                                       │
│          ▼                                                       │
│   ┌──────────────┐         ┌──────────────┐                     │
│   │  SongRecord  │         │   Gallery    │                     │
│   │   演唱记录    │         │    图集      │                     │
│   └──────────────┘         └──────┬───────┘                     │
│                                   │ 自引用                        │
│                                   │ (1:N)                         │
│                                   ▼                               │
│                            ┌──────────────┐                     │
│                            │   Gallery    │                     │
│                            │   (子图集)    │                     │
│                            └──────────────┘                     │
│                                                                 │
│   ┌──────────────┐         ┌──────────────┐                     │
│   │   FanWork    │         │  Livestream  │                     │
│   │   二创作品    │         │   直播记录    │                     │
│   └──────────────┘         └──────┬───────┘                     │
│                                   │                              │
│                    ┌──────────────┼──────────────┐               │
│                    │              │              │               │
│                    ▼              ▼              ▼               │
│            ┌──────────┐   ┌──────────┐   ┌──────────┐          │
│            │ recordings│   │ songCuts │   │screenshots│          │
│            │ 分段视频  │   │ 当日歌切 │   │ 直播截图 │          │
│            └──────────┘   └──────────┘   └──────────┘          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 三、基础设施层 (Infrastructure)

### 3.1 API 服务层

#### 3.1.1 服务接口定义

```typescript
// domain/api/ISongService.ts
interface ISongService {
    getSongs(params: GetSongsParams): Promise<ApiResult<PaginatedResult<Song>>>;
    getRecords(songId: string, params?: GetRecordsParams): Promise<ApiResult<PaginatedResult<SongRecord>>>;
    getTopSongs(params?: GetTopSongsParams): Promise<ApiResult<Song[]>>;
    getRandomSong(): Promise<ApiResult<Song>>;
    getRecommendation(): Promise<ApiResult<Recommendation>>;
    getOriginalWorks(): Promise<ApiResult<OriginalWork[]>>;
    getLivestreams(year: number, month: number): Promise<ApiResult<Livestream[]>>;
    getLivestreamByDate(dateStr: string): Promise<ApiResult<Livestream | null>>;
}

interface IFanDIYService {
    getCollections(params?: GetWorksParams): Promise<ApiResult<PaginatedResult<FanCollection>>>;
    getCollection(id: number): Promise<ApiResult<FanCollection>>;
    getWorks(params?: GetWorksParams): Promise<ApiResult<PaginatedResult<FanWork>>>;
    getWork(id: number): Promise<ApiResult<FanWork>>;
}
```

#### 3.1.2 API 客户端实现

```
┌─────────────────────────────────────────────────────────────────┐
│                      API 客户端架构                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                     ApiClient                            │  │
│   │                    (基础客户端)                          │  │
│   │                                                         │  │
│   │  - baseURL 配置                                         │  │
│   │  - request() 通用请求方法                                │  │
│   │  - get()/post() 快捷方法                                 │  │
│   │  - 错误处理                                              │  │
│   │  - 响应格式转换                                          │  │
│   │                                                         │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              │                                  │
│           ┌──────────────────┼──────────────────┐               │
│           │                  │                  │               │
│           ▼                  ▼                  ▼               │
│   ┌──────────────┐   ┌──────────────┐   ┌──────────────┐       │
│   │RealSongService│   │RealFanDIYService│   │RealGalleryService│       │
│   │   歌曲服务    │   │  二创服务     │   │  图集服务    │       │
│   └──────────────┘   └──────────────┘   └──────────────┘       │
│                                                                 │
│   服务单例导出:                                                   │
│   export const songService = new RealSongService();             │
│   export const fanDIYService = new RealFanDIYService();         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 数据获取层

#### 3.2.1 SWR 配置

```typescript
// infrastructure/hooks/useData.ts
export function useSongs(params: GetSongsParams) {
    const { data, error, isLoading } = useSWR(
        ['songs', params],
        () => songService.getSongs(params),
        {
            revalidateOnFocus: false,
            dedupingInterval: 5000,
        }
    );
    return { data, error, isLoading };
}

export function useRecords(songId: string, params?: GetRecordsParams) {
    const { data, error, isLoading } = useSWR(
        songId ? ['records', songId, params] : null,
        () => songService.getRecords(songId, params),
        {
            revalidateOnFocus: false,
        }
    );
    return { data, error, isLoading };
}
```

#### 3.2.2 数据流图

```
┌─────────────────────────────────────────────────────────────────┐
│                      SWR 数据流                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   页面组件                                                       │
│   ┌─────────┐                                                   │
│   │  Page   │                                                   │
│   └────┬────┘                                                   │
│        │ useSongs(params)                                        │
│        ▼                                                        │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                         SWR                             │  │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │  │
│   │  │   Cache     │  │  Deduping   │  │  Revalidation│    │  │
│   │  │   缓存      │  │   去重      │  │   重新验证   │    │  │
│   │  └─────────────┘  └─────────────┘  └─────────────┘     │  │
│   └─────────────────────────┬───────────────────────────────┘  │
│                             │                                   │
│              缓存未命中/过期   │                                   │
│                             ▼                                   │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    Service Layer                        │  │
│   │                  (songService.getSongs)                 │  │
│   └─────────────────────────┬───────────────────────────────┘  │
│                             │                                   │
│                             ▼                                   │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                     API Layer                           │  │
│   │              (fetch / axios / xmlhttprequest)           │  │
│   └─────────────────────────┬───────────────────────────────┘  │
│                             │                                   │
│                             ▼                                   │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    Django Backend                       │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 四、表现层 (Presentation)

### 4.1 组件分层

#### 4.1.1 通用组件 (common)

| 组件 | 功能 | Props |
|------|------|-------|
| `ErrorBoundary` | 错误边界，捕获子组件错误 | `children`, `fallback` |
| `Loading` | 加载状态指示器 | `size`, `className` |
| `LazyImage` | 懒加载图片，支持占位符 | `src`, `alt`, `placeholder` |
| `VideoModal` | 视频播放弹窗 | `isOpen`, `onClose`, `videoUrl` |
| `MusicPlayer` | 音频播放器 | `src`, `title`, `cover` |
| `MysteryBoxModal` | 随机歌曲盲盒 | `isOpen`, `onClose`, `onSelect` |
| `SmartPlayController` | 智能播放控制器 | `songs`, `currentIndex` |

#### 4.1.2 功能组件 (features)

| 组件 | 功能 | 依赖 |
|------|------|------|
| `SongTable` | 歌曲列表表格 | `useSongs`, `useFilters` |
| `RecordList` | 演唱记录列表 | `useRecords` |
| `RankingChart` | 排行榜图表 | `useTopSongs` |
| `OriginalsList` | 原创作品列表 | `useOriginalWorks` |
| `TimelineChart` | 时间线图表 | `useTimelineData` |

#### 4.1.3 布局组件 (layout)

| 组件 | 功能 |
|------|------|
| `Navbar` | 导航栏，包含 Logo、菜单、搜索 |
| `Footer` | 页脚，包含版权、链接 |

### 4.2 组件层次结构

```
┌─────────────────────────────────────────────────────────────────┐
│                      组件层次结构                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                      App.tsx                             │  │
│   │                    (应用根组件)                          │  │
│   └─────────────────────────┬───────────────────────────────┘  │
│                             │                                   │
│           ┌─────────────────┼─────────────────┐                 │
│           │                 │                 │                 │
│           ▼                 ▼                 ▼                 │
│   ┌──────────┐      ┌──────────┐      ┌──────────┐             │
│   │  Navbar  │      │   Main   │      │  Footer  │             │
│   │  导航栏  │      │  主内容区 │      │  页脚    │             │
│   └──────────┘      └────┬─────┘      └──────────┘             │
│                          │                                      │
│                          ▼                                      │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    Routes (路由)                        │  │
│   │  ┌────────┬────────┬────────┬────────┬────────┐        │  │
│   │  │ Home   │ Songs  │Gallery │  Live  │  ...   │        │  │
│   │  │ 首页   │ 歌曲   │ 图集   │ 直播   │ 其他   │        │  │
│   │  └────────┴────────┴────────┴────────┴────────┘        │  │
│   └─────────────────────────────────────────────────────────┘  │
│                          │                                      │
│                          ▼                                      │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    Page Components                       │  │
│   │  ┌─────────────────────────────────────────────────┐   │  │
│   │  │              页面级组件                          │   │  │
│   │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐        │   │  │
│   │  │  │Feature   │ │Feature   │ │Feature   │ ...    │   │  │
│   │  │  │Components│ │Components│ │Components│        │   │  │
│   │  │  └──────────┘ └──────────┘ └──────────┘        │   │  │
│   │  └─────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────┘  │
│                          │                                      │
│                          ▼                                      │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                   Common Components                      │  │
│   │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │  │
│   │  │ Loading  │ │LazyImage │ │VideoModal│ │  ...     │   │  │
│   │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 五、共享层 (Shared)

### 5.1 通用 Hooks

| Hook | 功能 | 返回值 |
|------|------|--------|
| `useClickOutside` | 监听点击外部事件 | `ref`, `isOutside` |
| `useDebounce` | 防抖处理 | `debouncedValue` |
| `useLocalStorage` | LocalStorage 封装 | `[value, setValue]` |
| `useMediaQuery` | 媒体查询 | `matches` |
| `useScrollPosition` | 滚动位置追踪 | `scrollPosition` |

### 5.2 工具函数

```typescript
// shared/utils/device.ts
export const isMobile = (): boolean => {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
        navigator.userAgent
    );
};

// shared/utils/videoUtils.ts
export const extractBvid = (url: string): string | null => {
    const match = url.match(/BV[a-zA-Z0-9]+/);
    return match ? match[0] : null;
};

// shared/utils/seoUtils.ts
export const generateMetaTags = (params: {
    title: string;
    description: string;
    image?: string;
}) => {
    return {
        title: `${params.title} | 咻咻满之家`,
        meta: [
            { name: 'description', content: params.description },
            { property: 'og:title', content: params.title },
            { property: 'og:description', content: params.description },
            { property: 'og:image', content: params.image },
        ],
    };
};
```

---

## 六、页面模块详解

### 6.1 首页 (HomePage)

#### 功能描述
- 展示推荐歌曲和今日推荐
- 显示热门歌曲排行榜
- 提供快速导航入口

#### 组件结构

```
HomePage
├── SEO (页面标题和元信息)
├── HeroSection (首屏横幅)
│   └── MysteryBoxModal (盲盒入口)
├── RecommendationSection (推荐区域)
│   └── SmartPlayController (智能播放)
├── RankingSection (排行榜区域)
│   └── RankingChart (排行榜图表)
└── QuickLinksSection (快速链接)
```

#### 数据流

```
┌─────────────────────────────────────────────────────────────────┐
│                      HomePage 数据流                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────┐     ┌─────────────┐     ┌─────────────────────┐  │
│   │  Page   │────▶│  useData    │────▶│  songService        │  │
│   │  Mount  │     │             │     │  .getRecommendation │  │
│   └─────────┘     └─────────────┘     └─────────────────────┘  │
│                                                │                │
│                                                ▼                │
│                                         ┌─────────────┐        │
│                                         │   SWR Cache │        │
│                                         └──────┬──────┘        │
│                                                │                │
│                                                ▼                │
│   ┌─────────┐     ┌─────────────┐     ┌─────────────────────┐  │
│   │  Render │◀────│  useData    │◀────│      Cache Hit      │  │
│   │         │     │  (订阅)     │     │                     │  │
│   └─────────┘     └─────────────┘     └─────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 歌曲列表页 (SongsPage)

#### 功能描述
- 完整的歌曲列表展示
- 多维度筛选（曲风、标签、语言）
- 分页和排序功能
- 搜索功能

#### 组件结构

```
SongsPage
├── PageHeader (页面标题)
├── FilterBar (筛选栏)
│   ├── SearchInput (搜索框)
│   ├── StyleFilter (曲风筛选)
│   ├── TagFilter (标签筛选)
│   └── LanguageFilter (语言筛选)
├── SongTable (歌曲表格)
│   ├── TableHeader (表头)
│   │   └── SortButton (排序按钮)
│   └── TableBody (表体)
│       └── SongRow (歌曲行)
│           └── RecordList (展开的记录列表)
└── Pagination (分页组件)
```

#### 状态管理

```typescript
// 筛选状态
interface FilterState {
    search: string;           // 搜索关键词
    styles: string[];         // 选中的曲风
    tags: string[];           // 选中的标签
    languages: string[];      // 选中的语言
    ordering: string;         // 排序方式
}

// 分页状态
interface PaginationState {
    page: number;             // 当前页
    pageSize: number;         // 每页数量
    total: number;            // 总数量
}
```

### 6.3 图集页 (GalleryPage)

#### 功能描述
- 多级图集浏览
- 图片懒加载
- 面包屑导航
- 灯箱查看

#### 组件结构

```
GalleryPage
├── Breadcrumb (面包屑导航)
├── GalleryGrid (图集网格)
│   └── GalleryCard (图集卡片)
│       ├── LazyImage (封面图)
│       └── GalleryInfo (图集信息)
├── ImageViewer (图片查看器)
│   ├── LazyImage (大图)
│   ├── ThumbnailList (缩略图列表)
│   └── Navigation (上一张/下一张)
└── EmptyState (空状态提示)
```

#### 数据流

```
┌─────────────────────────────────────────────────────────────────┐
│                      GalleryPage 数据流                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   1. 图集列表加载                                                │
│   ┌─────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│   │  Page   │───▶│ useGallery  │───▶│ RealGalleryService  │    │
│   │  Load   │    │             │    │   .getGalleries()   │    │
│   └─────────┘    └─────────────┘    └─────────────────────┘    │
│                                                           │     │
│   2. 图片懒加载                                                  │
│   ┌─────────┐    ┌─────────────┐    ┌─────────────────────┐    │
│   │ LazyImage│───▶│ Intersection│───▶│     Load Image      │    │
│   │ 进入视口 │    │   Observer  │    │                     │    │
│   └─────────┘    └─────────────┘    └─────────────────────┘    │
│                                                           │     │
│   3. 缩略图生成                                                  │
│   ┌─────────┐    ┌─────────────────┐                           │
│   │  Image  │───▶│ /api/gallery/   │                           │
│   │  URL    │    │   thumbnail/    │                           │
│   └─────────┘    └─────────────────┘                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.4 直播日历页 (LivestreamPage)

#### 功能描述
- 日历视图展示直播日期
- 直播详情弹窗
- 当日歌切列表
- 直播截图轮播

#### 组件结构

```
LivestreamPage
├── CalendarSection (日历区域)
│   ├── CalendarHeader (日历头部)
│   │   ├── MonthSelector (月份选择)
│   │   └── YearSelector (年份选择)
│   └── CalendarGrid (日历网格)
│       └── CalendarCell (日历单元格)
│           └── LivestreamIndicator (直播标记)
├── LivestreamModal (直播详情弹窗)
│   ├── VideoPlayer (视频播放器)
│   ├── SongCutList (歌切列表)
│   ├── ScreenshotCarousel (截图轮播)
│   └── DanmakuCloud (弹幕云图)
└── EmptyState (空状态)
```

### 6.5 数据分析页 (DataAnalysisPage)

#### 功能描述
- 粉丝数趋势图表
- 作品数据统计
- 播放量分析
- 多维度数据筛选

#### 组件结构

```
DataAnalysisPage
├── FilterSection (筛选区域)
│   ├── TimeRangeSelector (时间范围)
│   ├── GranularitySelector (粒度选择)
│   └── PlatformSelector (平台选择)
├── ChartSection (图表区域)
│   ├── FollowerChart (粉丝数图表)
│   ├── ViewChart (播放量图表)
│   └── InteractionChart (互动数据图表)
├── StatsSection (统计数据)
│   └── StatCard (统计卡片)
└── TableSection (数据表格)
    └── DataTable (数据表格)
```

### 6.6 粉丝二创页 (FansDIYPage)

#### 功能描述
- 合集列表展示
- 作品瀑布流布局
- 视频播放弹窗

#### 组件结构

```
FansDIYPage
├── CollectionNav (合集导航)
│   └── CollectionTab (合集标签)
├── WorkGrid (作品网格)
│   └── WorkCard (作品卡片)
│       ├── LazyImage (封面图)
│       ├── WorkInfo (作品信息)
│       └── PlayButton (播放按钮)
└── VideoModal (视频弹窗)
```

---

## 七、数据流总览

### 7.1 全局数据流

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              前端全局数据流                                          │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   用户操作                                                                           │
│      │                                                                              │
│      ▼                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                          UI Components                                       │  │
│   │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │  │
│   │  │  Button  │ │  Input   │ │  Select  │ │  Modal   │ │   ...    │          │  │
│   │  └────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘          │  │
│   │       └─────────────┴─────────────┴─────────────┘                         │  │
│   └────────────────────────────────┬──────────────────────────────────────────┘  │
│                                    │                                                │
│                                    │ dispatch / callback                             │
│                                    ▼                                                │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                            Page State                                        │  │
│   │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                      │  │
│   │  │  useState    │  │  useReducer  │  │  useContext  │                      │  │
│   │  │  本地状态    │  │  复杂状态    │  │  全局状态    │                      │  │
│   │  └──────────────┘  └──────────────┘  └──────────────┘                      │  │
│   └────────────────────────────────┬──────────────────────────────────────────┘  │
│                                    │                                                │
│                                    │ call                                             │
│                                    ▼                                                │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                         Service Layer                                        │  │
│   │                    (ISongService, IFanDIYService)                            │  │
│   └────────────────────────────────┬──────────────────────────────────────────┘  │
│                                    │                                                │
│                                    │ implement                                       │
│                                    ▼                                                │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                       Infrastructure Layer                                   │  │
│   │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                      │  │
│   │  │  RealSong    │  │  RealFanDIY  │  │  RealGallery │                      │  │
│   │  │  Service     │  │  Service     │  │  Service     │                      │  │
│   │  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘                      │  │
│   │         └─────────────────┴─────────────────┘                               │  │
│   └────────────────────────────────┬──────────────────────────────────────────┘  │
│                                    │                                                │
│                                    │ fetch                                           │
│                                    ▼                                                │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                           SWR Cache                                          │  │
│   │  ┌─────────────────────────────────────────────────────────────────────┐   │  │
│   │  │  Key-Value Store (stale-while-revalidate)                           │   │  │
│   │  │  - 自动缓存                                                        │   │  │
│   │  │  - 自动重新验证                                                     │   │  │
│   │  │  - 去重请求                                                        │   │  │
│   │  └─────────────────────────────────────────────────────────────────────┘   │  │
│   └────────────────────────────────┬──────────────────────────────────────────┘  │
│                                    │                                                │
│                                    │ HTTP Request                                    │
│                                    ▼                                                │
│   ┌─────────────────────────────────────────────────────────────────────────────┐  │
│   │                           REST API                                           │  │
│   │  ┌─────────────────────────────────────────────────────────────────────┐   │  │
│   │  │  /api/songs/  /api/gallery/  /api/livestream/  /api/fansDIY/        │   │  │
│   │  └─────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 路由配置

```typescript
// App.tsx 路由配置
const routes = [
    { path: '/', element: <HomePage /> },
    { path: '/songs', element: <SongsPage /> },
    { path: '/songs/hot', element: <SongsPage /> },
    { path: '/songs/originals', element: <SongsPage /> },
    { path: '/originals', element: <OriginalsPage /> },
    { path: '/gallery', element: <GalleryPage /> },
    { path: '/gallery/:galleryId', element: <GalleryPage /> },
    { path: '/live', element: <LivestreamPage /> },
    { path: '/data', element: <DataAnalysisPage /> },
    { path: '/fansDIY', element: <FansDIYPage /> },
    { path: '/fansDIY/:collectionId', element: <FansDIYPage /> },
    { path: '/about', element: <AboutPage /> },
    { path: '/contact', element: <ContactPage /> },
];
```

### 7.3 性能优化策略

```
┌─────────────────────────────────────────────────────────────────┐
│                      性能优化策略                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   1. 代码分割 (Code Splitting)                                   │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │  const HomePage = lazy(() => import('./pages/HomePage'));│  │
│   │  const SongsPage = lazy(() => import('./pages/SongsPage'));│ │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   2. 图片懒加载                                                  │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │  <LazyImage                                             │  │
│   │    src={imageUrl}                                       │  │
│   │    placeholder="/placeholder.jpg"                       │  │
│   │    observerOptions={{ rootMargin: '50px' }}             │  │
│   │  />                                                     │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   3. 数据缓存 (SWR)                                              │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │  const { data } = useSWR(key, fetcher, {               │  │
│   │    revalidateOnFocus: false,                            │  │
│   │    dedupingInterval: 5000,                              │  │
│   │    refreshInterval: 300000,                             │  │
│   │  });                                                    │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   4. 组件级缓存                                                  │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │  const MemoizedComponent = React.memo(Component, (prev, next) => {
│   │    return prev.id === next.id;                          │  │
│   │  });                                                    │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   5. 虚拟列表 (Virtual List)                                     │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │  用于长列表优化，只渲染可视区域元素                        │  │
│   │  - react-window                                          │  │
│   │  - react-virtualized                                     │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 八、总结

XXM Fans Home 前端采用现代化的 React + TypeScript 技术栈，遵循 DDD 架构原则：

1. **领域层 (Domain)** - 定义核心业务模型和接口，与技术实现无关
2. **基础设施层 (Infrastructure)** - 实现领域接口，处理 API 调用和配置
3. **表现层 (Presentation)** - UI 组件和页面，依赖领域接口而非具体实现
4. **共享层 (Shared)** - 通用工具函数和 Hooks，供各层复用

**核心特点**：
- 依赖倒置：高层模块依赖抽象接口
- 单向数据流：UI → State → Service → API
- 数据缓存：SWR 提供自动缓存和重新验证
- 性能优化：代码分割、懒加载、组件缓存

这种架构使得代码具有良好的可测试性、可维护性和可扩展性。
