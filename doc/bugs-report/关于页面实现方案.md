# 关于页面实现方案

## 一、需求说明

关于页面需要展示以下内容：
1. **艺人个人信息**：生日、星座、栖息地、爱好
2. **声线特色**：戏韵、治愈、张力、灵动
3. **成长里程碑时间线**：按年份展示重要事件
4. **社交媒体链接**：Bilibili、微博、网易云音乐

---

## 二、数据模型设计

### 1. 扩展现有 SiteSettings 模型

在 `site_settings/models.py` 中扩展 `SiteSettings` 模型，添加艺人相关字段：

```python
# site_settings/models.py

class SiteSettings(models.Model):
    """网站设置模型"""
    favicon = models.ImageField(
        upload_to='settings/',
        blank=True,
        null=True,
        verbose_name="网站图标"
    )

    # 新增艺人信息字段
    artist_name = models.CharField(max_length=100, blank=True, verbose_name="艺人名称")
    artist_avatar = models.ImageField(
        upload_to='settings/',
        blank=True,
        null=True,
        verbose_name="艺人头像"
    )
    artist_birthday = models.DateField(blank=True, null=True, verbose_name="艺人生日")
    artist_constellation = models.CharField(max_length=50, blank=True, verbose_name="星座")
    artist_location = models.CharField(max_length=200, blank=True, verbose_name="栖息地")
    artist_hobbies = models.JSONField(default=list, verbose_name="爱好")
    artist_voice_features = models.JSONField(default=list, verbose_name="声线特色")

    # 社交媒体链接
    bilibili_url = models.URLField(max_length=500, blank=True, verbose_name="B站链接")
    weibo_url = models.URLField(max_length=500, blank=True, verbose_name="微博链接")
    netease_music_url = models.URLField(max_length=500, blank=True, verbose_name="网易云音乐链接")

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name = "网站设置"
        verbose_name_plural = "网站设置"

    def __str__(self):
        return "网站设置"
```

### 2. 创建 Milestone 模型

```python
# site_settings/models.py

class Milestone(models.Model):
    """里程碑模型"""
    year = models.IntegerField(verbose_name="年份")
    title = models.CharField(max_length=200, verbose_name="里程碑标题")
    description = models.TextField(verbose_name="里程碑描述")
    display_order = models.IntegerField(default=0, verbose_name="显示顺序")
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        verbose_name = "里程碑"
        verbose_name_plural = "里程碑"
        ordering = ['display_order', 'year']

    def __str__(self):
        return f"{self.year} - {self.title}"
```

---

## 三、序列化器设计

```python
# site_settings/serializers.py

from rest_framework import serializers
from .models import SiteSettings, Milestone


class MilestoneSerializer(serializers.ModelSerializer):
    """里程碑序列化器"""

    class Meta:
        model = Milestone
        fields = ['id', 'year', 'title', 'description', 'display_order']


class SiteSettingsSerializer(serializers.ModelSerializer):
    """网站设置序列化器（扩展版）"""

    class Meta:
        model = SiteSettings
        fields = [
            'id',
            'favicon',
            'artist_name',
            'artist_avatar',
            'artist_birthday',
            'artist_constellation',
            'artist_location',
            'artist_hobbies',
            'artist_voice_features',
            'bilibili_url',
            'weibo_url',
            'netease_music_url',
            'created_at',
            'updated_at',
        ]
```

---

## 四、API接口设计

```python
# site_settings/api/views.py

from rest_framework.generics import ListAPIView
from core.responses import success_response
from .serializers import MilestoneSerializer
from .models import Milestone


class MilestoneListView(ListAPIView):
    """里程碑列表视图"""
    serializer_class = MilestoneSerializer

    def get_queryset(self):
        return Milestone.objects.all().order_by('display_order', 'year')

    def list(self, request, *args, **kwargs):
        queryset = self.get_queryset()
        serializer = self.get_serializer(queryset, many=True)
        return success_response(data=serializer.data)
```

---

## 五、API端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/site-settings/settings/` | GET | 获取网站设置（已存在，需扩展） |
| `/api/site-settings/milestones/` | GET | 获取里程碑列表（新增） |

---

## 六、Admin后台配置

```python
# site_settings/admin.py

from django.contrib import admin
from .models import SiteSettings, Milestone


@admin.register(SiteSettings)
class SiteSettingsAdmin(admin.ModelAdmin):
    """网站设置Admin"""
    list_display = ['artist_name', 'artist_birthday', 'artist_constellation', 'artist_location']
    fieldsets = (
        ('基础设置', {
            'fields': ('favicon',)
        }),
        ('艺人信息', {
            'fields': ('artist_name', 'artist_avatar', 'artist_birthday', 'artist_constellation', 'artist_location')
        }),
        ('艺人特色', {
            'fields': ('artist_hobbies', 'artist_voice_features')
        }),
        ('社交媒体', {
            'fields': ('bilibili_url', 'weibo_url', 'netease_music_url')
        }),
    )


@admin.register(Milestone)
class MilestoneAdmin(admin.ModelAdmin):
    """里程碑Admin"""
    list_display = ['year', 'title', 'display_order']
    list_filter = ['year']
    search_fields = ['title', 'description']
    ordering = ['display_order', 'year']
```

---

## 七、URL路由配置

```python
# site_settings/urls.py

from django.urls import path
from .api.views import SiteSettingsView, MilestoneListView

urlpatterns = [
    path('settings/', SiteSettingsView.as_view(), name='site-settings'),
    path('milestones/', MilestoneListView.as_view(), name='milestones'),
]
```

---

## 八、实施步骤

1. **扩展 SiteSettings 模型**
   - 在 `site_settings/models.py` 中添加艺人相关字段
   - 添加社交媒体链接字段

2. **创建 Milestone 模型**
   - 在 `site_settings/models.py` 中定义 Milestone 模型

3. **创建序列化器**
   - 在 `site_settings/serializers.py` 中创建 `MilestoneSerializer`
   - 扩展 `SiteSettingsSerializer`

4. **实现API视图**
   - 在 `site_settings/api/views.py` 中实现 `MilestoneListView`

5. **配置Admin后台**
   - 在 `site_settings/admin.py` 中配置 Admin 界面

6. **配置URL路由**
   - 在 `site_settings/urls.py` 中添加里程碑路由

7. **执行数据库迁移**
   ```bash
   python manage.py makemigrations site_settings
   python manage.py migrate site_settings
   ```

8. **API测试**
   - 测试获取网站设置接口
   - 测试获取里程碑列表接口

---

## 九、数据示例

### SiteSettings 数据示例

```json
{
  "id": 1,
  "favicon": "/media/settings/favicon.png",
  "artist_name": "咻咻满",
  "artist_avatar": "/media/settings/avatar.png",
  "artist_birthday": "2000-01-01",
  "artist_constellation": "摩羯座",
  "artist_location": "中国",
  "artist_hobbies": ["唱歌", "画画", "游戏"],
  "artist_voice_features": ["戏韵", "治愈", "张力", "灵动"],
  "bilibili_url": "https://space.bilibili.com/xxxxx",
  "weibo_url": "https://weibo.com/xxxxx",
  "netease_music_url": "https://music.163.com/#/artist?id=xxxxx"
}
```

### Milestone 数据示例

```json
[
  {
    "id": 1,
    "year": 2020,
    "title": "首次直播",
    "description": "在B站开启首次个人直播",
    "display_order": 1
  },
  {
    "id": 2,
    "year": 2021,
    "title": "粉丝突破10万",
    "description": "B站粉丝数量突破10万",
    "display_order": 2
  },
  {
    "id": 3,
    "year": 2022,
    "title": "首张专辑发布",
    "description": "发布首张个人原创专辑",
    "display_order": 3
  }
]
```

---

## 十、优先级与预估时间

- **优先级**: 中
- **预估时间**: 2-3天

---

## 十一、相关文档

- 前端 V2 适配方案: `/doc/backend/FRONTEND_V2_ADAPTER_PLAN.md`
- 后端 API 文档: `/repo/xxm_fans_backend/doc/API文档.md`
- 前端 API 文档: `/repo/xxm_fans_frontend/doc/API_doc.md`