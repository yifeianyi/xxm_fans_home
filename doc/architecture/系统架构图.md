# XXM Fans Home 项目架构图

本文档详细描述了 XXM Fans Home 项目的整体架构，包括前后端技术栈和线上部署架构。

---

## 一、整体架构概览

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    用户访问层                                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │
│  │   浏览器     │  │   移动端     │  │   CDN节点    │  │  爬虫系统    │  │  管理员      │   │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘   │
└─────────┼────────────────┼────────────────┼────────────────┼────────────────┼──────────┘
          │                │                │                │                │
          ▼                ▼                ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    网络接入层                                            │
│                           ┌─────────────────────────┐                                   │
│                           │      Nginx 反向代理      │                                   │
│                           │  - SSL/TLS 终止         │                                   │
│                           │  - 静态文件服务          │                                   │
│                           │  - 负载均衡              │                                   │
│                           │  - 路由分发              │                                   │
│                           └───────────┬─────────────┘                                   │
└───────────────────────────────────────┼─────────────────────────────────────────────────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    ▼                   ▼                   ▼
┌─────────────────────────┐  ┌─────────────────────────┐  ┌─────────────────────────┐
│     前端应用层           │  │      后端 API 层        │  │      Admin 管理后台      │
│  ┌─────────────────┐   │  │  ┌─────────────────┐   │  │  ┌─────────────────┐   │
│  │  React SPA      │   │  │  │  Django REST    │   │  │  │  Django Admin   │   │
│  │  - 主网站        │   │  │  │  Framework      │   │  │  │  - 数据管理      │   │
│  │  - 模板化歌单    │   │  │  │  - RESTful API  │   │  │  │  - 内容审核      │   │
│  │                 │   │  │  │  - 权限控制      │   │  │  │  - 爬虫管理      │   │
│  │  Vue SPA        │   │  │  │  - 序列化器      │   │  │  │  - 系统配置      │   │
│  │  - 歌单模板      │   │  │  │  - 分页过滤      │   │  │  │                 │   │
│  └─────────────────┘   │  │  └─────────────────┘   │  │  └─────────────────┘   │
└───────────┬─────────────┘  └───────────┬─────────────┘  └───────────┬─────────────┘
            │                            │                            │
            ▼                            ▼                            ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    业务服务层                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐│
│  │ song_management│ │   fansDIY    │ │   gallery    │ │  livestream  │ │data_analytics││
│  │   音乐资产管理  │ │  粉丝二创管理  │ │   图集管理   │ │  直播日历管理  │ │  数据分析    ││
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘│
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐                                  │
│  │site_settings │ │   songlist   │ │    core      │                                  │
│  │   网站设置   │ │  模板化歌单   │ │   核心模块   │                                  │
│  └──────────────┘ └──────────────┘ └──────────────┘                                  │
└───────────────────────────────────────┬─────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    数据存储层                                          │
│  ┌────────────────────────────────┐  ┌──────────────────────────────────────────┐   │
│  │      SQLite 主数据库            │  │           文件系统                        │   │
│  │  - song_management             │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐  │   │
│  │  - fansDIY                     │  │  │  covers  │ │ gallery  │ │footprint │  │   │
│  │  - gallery                     │  │  │  封面图片 │ │  图集图片 │ │ 二创图片 │  │   │
│  │  - livestream                  │  │  └──────────┘ └──────────┘ └──────────┘  │   │
│  │  - data_analytics              │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐  │   │
│  │  - site_settings               │  │  │cloud_pic │ │songlist  │ │staticfiles│  │   │
│  │  - songlist (独立数据库)        │  │  │ 弹幕云图 │ │ 歌单资源 │ │ 静态文件 │  │   │
│  └────────────────────────────────┘  └──────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、前端架构详解

### 2.1 技术栈

| 层级 | 技术 | 版本 | 用途 |
|------|------|------|------|
| 框架 | React | 19.2.3 | UI 组件库 |
| 语言 | TypeScript | 5.8.2 | 类型安全 |
| 构建 | Vite | 6.2.0 | 开发服务器和打包 |
| 路由 | React Router DOM | 7.12.0 | 客户端路由 |
| 数据获取 | SWR | 2.4.0 | 数据缓存和重新验证 |
| 样式 | Tailwind CSS | 4.1.18 | 原子化 CSS |
| 图标 | Lucide React | 0.562.0 | 图标库 |
| 图片处理 | Sharp | 0.34.5 | 图片优化 |

### 2.2 前端项目结构

```
xxm_fans_frontend/
├── src/
│   ├── domain/                 # 领域层 - 业务核心
│   │   ├── types.ts           # 领域模型类型定义
│   │   ├── api/
│   │   │   ├── ISongService.ts
│   │   │   └── ISubmissionService.ts
│   │   └── constants.ts       # 领域常量
│   │
│   ├── infrastructure/         # 基础设施层 - 技术实现
│   │   ├── api/               # API 服务实现
│   │   │   ├── RealSongService.ts
│   │   │   ├── RealGalleryService.ts
│   │   │   ├── RealSiteSettingsService.ts
│   │   │   ├── RealDataAnalyticsService.ts
│   │   │   └── RealSubmissionService.ts
│   │   ├── config/            # 配置管理
│   │   │   ├── config.ts
│   │   │   ├── constants.ts
│   │   │   └── routes.ts
│   │   ├── hooks/             # 基础设施 Hooks
│   │   │   ├── useData.ts
│   │   │   └── useSWRConfig.ts
│   │   └── components/        # 基础设施组件
│   │       ├── SEO.tsx
│   │       └── SWRProvider.tsx
│   │
│   ├── presentation/          # 表现层 - UI 组件
│   │   ├── components/
│   │   │   ├── common/        # 通用组件
│   │   │   │   ├── ErrorBoundary.tsx
│   │   │   │   ├── Loading.tsx
│   │   │   │   ├── VideoModal.tsx
│   │   │   │   ├── LazyImage.tsx
│   │   │   │   ├── MusicPlayer.tsx
│   │   │   │   └── SmartPlayController.tsx
│   │   │   ├── features/      # 功能组件
│   │   │   │   ├── SongTable.tsx
│   │   │   │   ├── RecordList.tsx
│   │   │   │   ├── RankingChart.tsx
│   │   │   │   └── TimelineChart.tsx
│   │   │   └── layout/        # 布局组件
│   │   │       ├── Navbar.tsx
│   │   │       └── Footer.tsx
│   │   ├── pages/             # 页面组件
│   │   │   ├── HomePage.tsx
│   │   │   ├── SongsPage.tsx
│   │   │   ├── FansDIYPage.tsx
│   │   │   ├── GalleryPage.tsx
│   │   │   ├── LivestreamPage.tsx
│   │   │   ├── DataAnalysisPage.tsx
│   │   │   ├── OriginalsPage.tsx
│   │   │   ├── AboutPage.tsx
│   │   │   └── ContactPage.tsx
│   │   └── hooks/             # 表现层 Hooks
│   │       └── useSongData.ts
│   │
│   ├── shared/                # 共享层 - 工具函数
│   │   ├── hooks/
│   │   │   ├── useClickOutside.ts
│   │   │   ├── useDebounce.ts
│   │   │   ├── useLocalStorage.ts
│   │   │   ├── useMediaQuery.ts
│   │   │   └── useScrollPosition.ts
│   │   ├── services/
│   │   │   └── VideoPlayerService.ts
│   │   └── utils/
│   │       ├── device.ts
│   │       ├── videoUtils.ts
│   │       └── seoUtils.ts
│   │
│   ├── App.tsx               # 应用入口
│   ├── main.tsx              # 渲染入口
│   └── index.css             # 全局样式
│
├── public/                   # 静态资源
├── dist/                     # 构建输出
└── vite.config.ts            # Vite 配置
```

### 2.3 前端架构模式：DDD（领域驱动设计）

```
┌─────────────────────────────────────────────────────────────┐
│                      前端 DDD 架构                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    表现层 (Presentation)             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │   Pages     │  │ Components  │  │    Hooks    │  │   │
│  │  │   页面组件   │  │   UI组件    │  │  业务Hooks  │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └────────────────────┬────────────────────────────────┘   │
│                       │ 依赖抽象（接口）                      │
│                       ▼                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    领域层 (Domain)                   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │    Types    │  │ Interfaces  │  │  Constants  │  │   │
│  │  │   类型定义   │  │   服务接口   │  │   常量定义   │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └────────────────────┬────────────────────────────────┘   │
│                       │ 实现抽象                             │
│                       ▼                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                 基础设施层 (Infrastructure)          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │  API Impl   │  │   Config    │  │  Providers  │  │   │
│  │  │  API实现    │  │   配置管理   │  │   提供者    │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                       │                                      │
│                       ▼                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    共享层 (Shared)                   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │    Utils    │  │    Hooks    │  │  Services   │  │   │
│  │  │   工具函数   │  │   通用Hooks │  │   共享服务   │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 三、后端架构详解

### 3.1 技术栈

| 层级 | 技术 | 版本 | 用途 |
|------|------|------|------|
| Web 框架 | Django | 5.2.3 | Web 应用框架 |
| API 框架 | Django REST Framework | 3.15.2 | RESTful API |
| 数据库 | SQLite | 3.x | 数据持久化 |
| 缓存 | Django Cache | - | 数据缓存 |
| 图片处理 | Pillow | - | 图片处理 |
| 跨域 | django-cors-headers | - | CORS 支持 |
| 任务调度 | systemd timer | - | 定时任务 |

### 3.2 后端项目结构

```
xxm_fans_backend/
├── xxm_fans_home/              # 项目配置
│   ├── settings.py            # Django 配置
│   ├── urls.py                # URL 路由配置
│   └── wsgi.py                # WSGI 配置
│
├── core/                       # 核心共享模块
│   ├── cache.py               # 缓存管理
│   ├── exceptions.py          # 自定义异常
│   ├── responses.py           # 统一响应格式
│   ├── thumbnail_generator.py # 缩略图生成器
│   └── middleware.py          # 自定义中间件
│
├── song_management/            # 音乐资产管理
│   ├── models/                # 数据模型
│   ├── api/                   # API 接口
│   ├── services/              # 业务逻辑
│   ├── admin/                 # 后台管理
│   └── management/            # 管理命令
│
├── fansDIY/                    # 粉丝二创管理
│   ├── models/
│   ├── api/
│   ├── services/
│   └── admin/
│
├── gallery/                    # 图集管理
│   ├── models.py
│   ├── api/
│   └── management/
│
├── livestream/                 # 直播日历
│   ├── models.py
│   ├── api/
│   └── services/
│
├── data_analytics/             # 数据分析
│   ├── models/
│   ├── api/
│   ├── services/
│   └── admin/
│
├── site_settings/              # 网站设置
│   ├── models/
│   ├── api/
│   └── admin/
│
├── songlist/                   # 模板化歌单
│   ├── models/
│   ├── api/
│   └── management/
│
├── tools/                      # 工具脚本
│   ├── bilibili/              # B站 API 封装
│   ├── spider/                # 爬虫工具
│   └── *.py                   # 导入脚本
│
└── test/                       # 性能测试
    ├── core/
    ├── song_management/
    ├── fansDIY/
    └── data_analytics/
```

### 3.3 后端分层架构

```
┌─────────────────────────────────────────────────────────────┐
│                      后端分层架构                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    API 层                            │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │    Views    │  │ Serializers │  │  Filters    │  │   │
│  │  │   视图函数   │  │   序列化器   │  │   过滤器    │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └────────────────────┬────────────────────────────────┘   │
│                       │ 调用服务层                            │
│                       ▼                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   Service 层                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │   Business  │  │ Validation  │  │  Utilities  │  │   │
│  │  │   业务逻辑   │  │   数据验证   │  │   工具方法   │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └────────────────────┬────────────────────────────────┘   │
│                       │ 操作数据模型                          │
│                       ▼                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   Model 层                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │    Model    │  │   Manager   │  │  Signals    │  │   │
│  │  │   数据模型   │  │   模型管理器 │  │   信号处理   │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └────────────────────┬────────────────────────────────┘   │
│                       │ 数据持久化                           │
│                       ▼                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  Database 层                         │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │           SQLite / MySQL / PostgreSQL        │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 四、线上部署架构

### 4.1 部署架构图

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    用户访问层                                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │
│  │   浏览器     │  │   移动端     │  │   CDN节点    │  │  搜索引擎爬虫 │                    │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                    │
└─────────┼────────────────┼────────────────┼────────────────┼──────────────────────────┘
          │                │                │                │
          │                │                │                │
          ▼                ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    DNS / CDN 层                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │                         DNS 解析 + CDN 加速                                       │   │
│  │  - 域名解析: xxm8777.cn / www.xxm8777.cn / admin.xxm8777.cn                      │   │
│  │  - CDN 缓存: 静态资源、图片、API 响应                                             │   │
│  │  - SSL 证书: Let's Encrypt                                                      │   │
│  └─────────────────────────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────┬─────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    Nginx 服务器                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │                           Nginx (反向代理 + 静态服务器)                            │   │
│  │                                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │  HTTP (80) → HTTPS (443) 重定向                                         │   │   │
│  │  │  - xxm8777.cn → https://www.xxm8777.cn                                │   │   │
│  │  │  - admin.xxm8777.cn → https://admin.xxm8777.cn                        │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │  HTTPS (443) - www.xxm8777.cn                                          │   │   │
│  │  │  - / → React SPA (dist/index.html)                                     │   │   │
│  │  │  - /api/ → Django (127.0.0.1:8000)                                     │   │   │
│  │  │  - /static/ → Django 静态文件                                          │   │   │
│  │  │  - /media/ → 媒体文件                                                  │   │   │
│  │  │  - /sitemap.xml, /robots.txt → Django                                  │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │  HTTPS (443) - admin.xxm8777.cn                                        │   │   │
│  │  │  - / → Django Admin (127.0.0.1:8000)                                   │   │   │
│  │  │  - /static/ → Django 静态文件                                          │   │   │
│  │  │  - /media/ → 媒体文件                                                  │   │   │
│  │  └─────────────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                                 │   │
│  └─────────────────────────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────┬─────────────────────────────────────────────────┘
                                        │
                    ┌───────────────────┴───────────────────┐
                    ▼                                       ▼
┌─────────────────────────────┐              ┌─────────────────────────────┐
│      Gunicorn 应用服务器     │              │         文件系统            │
│  ┌─────────────────────┐   │              │  ┌─────────────────────┐   │
│  │   Django + DRF      │   │              │  │   React dist/       │   │
│  │   - RESTful API     │   │              │  │   - index.html      │   │
│  │   - Admin 后台      │   │              │  │   - 静态资源        │   │
│  │   - SEO 生成        │   │              │  │                     │   │
│  └─────────────────────┘   │              │  │   media/            │   │
└─────────────────────────────┘              │  │   - covers/         │   │
                                             │  │   - gallery/        │   │
┌─────────────────────────────┐              │  │   - footprint/      │   │
│      定时任务 (systemd)      │              │  │   - cloud_picture/  │   │
│  ┌─────────────────────┐   │              │  │   - songlist/       │   │
│  │  bilibili-tiered-   │   │              │  │                     │   │
│  │  crawler.timer      │   │              │  │   staticfiles/      │   │
│  │  (每小时)            │   │              │  │   - admin/          │   │
│  ├─────────────────────┤   │              │  │   - rest_framework/ │   │
│  │  bilibili-views-    │   │              │  └─────────────────────┘   │
│  │  crawler.timer      │   │              └─────────────────────────────┘
│  │  (每天)              │   │
│  ├─────────────────────┤   │
│  │  bilibili-spider.   │   │
│  │  timer (粉丝数)      │   │
│  └─────────────────────┘   │
└─────────────────────────────┘
```

### 4.2 请求流程图

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│   用户    │────▶│   DNS    │────▶│   CDN    │────▶│  Nginx   │────▶│ 后端服务 │
│  浏览器   │     │   解析   │     │   加速   │     │  反向代理 │     │         │
└──────────┘     └──────────┘     └──────────┘     └────┬─────┘     └────┬────┘
                                                        │                │
                    ┌───────────────────────────────────┘                │
                    │                                                    │
                    ▼                                                    │
           ┌─────────────────┐                                           │
           │  静态资源请求?   │                                           │
           └────────┬────────┘                                           │
                    │                                                    │
         ┌─────────┴─────────┐                                          │
         │                   │                                          │
         ▼                   ▼                                          │
   ┌────────────┐     ┌────────────┐                                   │
   │    是      │     │    否      │                                   │
   └─────┬──────┘     └─────┬──────┘                                   │
         │                  │                                          │
         ▼                  ▼                                          ▼
   ┌────────────┐     ┌─────────────────────────────────────────────────────┐
   │ 返回静态文件 │     │                  路由判断                            │
   │ (缓存优先) │     │  ┌─────────────────────────────────────────────────┐ │
   └────────────┘     │  │  /api/* → Gunicorn → Django                     │ │
                      │  │  /admin/* → Gunicorn → Django Admin             │ │
                      │  │  /sitemap.xml → Gunicorn → Django               │ │
                      │  │  /robots.txt → Gunicorn → Django                │ │
                      │  │  /* → React SPA (index.html)                     │ │
                      │  └─────────────────────────────────────────────────┘ │
                      └─────────────────────────────────────────────────────┘
```

### 4.3 数据持久化架构

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    数据存储架构                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                          SQLite 数据库                                       │   │
│  │                                                                             │   │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │   │
│  │   │ 主数据库    │  │ songlist_db │  │ 缓存表      │  │ 日志表      │      │   │
│  │   │ (默认)      │  │ (歌单专用)  │  │             │  │             │      │   │
│  │   │             │  │             │  │             │  │             │      │   │
│  │   │ • song_     │  │ • xxm_      │  │ • django_   │  │ • crawl_    │      │   │
│  │   │   management│  │   songs     │  │   cache     │  │   sessions  │      │   │
│  │   │ • fansDIY   │  │ • youyou_   │  │             │  │ • work_     │      │   │
│  │   │ • gallery   │  │   songs     │  │             │  │   metrics   │      │   │
│  │   │ • livestream│  │ • bingjie_  │  │             │  │             │      │   │
│  │   │ • data_     │  │   songs     │  │             │  │             │      │   │
│  │   │   analytics │  │             │  │             │  │             │      │   │
│  │   │ • site_     │  │             │  │             │  │             │      │   │
│  │   │   settings  │  │             │  │             │  │             │      │   │
│  │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                                │
│                                    │ 读写操作                                        │
│                                    ▼                                                │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                          文件系统                                            │   │
│  │                                                                             │   │
│  │   ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐              │   │
│  │   │   media/        │ │   staticfiles/  │ │   logs/         │              │   │
│  │   │                 │ │                 │ │                 │              │   │
│  │   │ ├── covers/     │ │ ├── admin/      │ │ ├── django.log  │              │   │
│  │   │ ├── footprint/  │ │ ├── rest_       │ │ ├── spider.log  │              │   │
│  │   │ ├── gallery/    │ │   framework/    │ │ └── gunicorn.log│              │   │
│  │   │ ├── cloud_      │ │ └── ...         │ │                 │              │   │
│  │   │   picture/      │ │                 │ │                 │              │   │
│  │   │ ├── songlist/   │ │                 │ │                 │              │   │
│  │   │ └── ...         │ │                 │ │                 │              │   │
│  │   └─────────────────┘ └─────────────────┘ └─────────────────┘              │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 五、模块间交互关系

### 5.1 模块依赖图

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    模块依赖关系                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│                              ┌──────────────┐                                      │
│                              │     core     │                                      │
│                              │   (核心模块)  │                                      │
│                              └──────┬───────┘                                      │
│                                     │ 被依赖                                        │
│         ┌───────────────────────────┼───────────────────────────┐                   │
│         │                           │                           │                   │
│         ▼                           ▼                           ▼                   │
│  ┌──────────────┐          ┌──────────────┐          ┌──────────────┐              │
│  │song_management│          │  fansDIY     │          │   gallery    │              │
│  │  音乐资产管理  │          │  粉丝二创管理  │          │   图集管理   │              │
│  └──────┬───────┘          └──────┬───────┘          └──────┬───────┘              │
│         │                         │                         │                      │
│         │                         │                         │                      │
│         ▼                         ▼                         ▼                      │
│  ┌──────────────┐          ┌──────────────┐          ┌──────────────┐              │
│  │  livestream  │          │data_analytics│          │site_settings │              │
│  │  直播日历管理  │          │   数据分析    │          │   网站设置   │              │
│  └──────┬───────┘          └──────────────┘          └──────────────┘              │
│         │                                                                          │
│         │ 依赖                                                                      │
│         ▼                                                                          │
│  ┌──────────────┐                                                                  │
│  │   songlist   │                                                                  │
│  │  模板化歌单   │                                                                  │
│  │ (独立数据库)  │                                                                  │
│  └──────────────┘                                                                  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 API 调用关系

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    API 调用关系                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   前端应用                                                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐            │
│  │   HomePage   │  │  SongsPage   │  │ FansDIYPage  │  │ GalleryPage  │ ...        │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘            │
│         │                 │                 │                 │                     │
│         └─────────────────┴─────────────────┴─────────────────┘                     │
│                                    │                                                │
│                                    ▼                                                │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                          RESTful API (Django)                                │   │
│  │                                                                             │   │
│  │   /api/songs/              → song_management.api.song_views                 │   │
│  │   /api/songs/<id>/records/ → song_management.api.record_views               │   │
│  │   /api/top_songs/          → song_management.api.other_views                │   │
│  │   /api/random-song/        → song_management.api.other_views                │   │
│  │   /api/styles/             → song_management.api.other_views                │   │
│  │   /api/tags/               → song_management.api.other_views                │   │
│  │   /api/originals/          → song_management.api.original_work_views        │   │
│  │                                                                             │   │
│  │   /api/fansDIY/collections/ → fansDIY.api.views                            │   │
│  │   /api/fansDIY/works/       → fansDIY.api.views                            │   │
│  │                                                                             │   │
│  │   /api/gallery/            → gallery.api.views                             │   │
│  │   /api/gallery/<id>/items/ → gallery.api.views                             │   │
│  │   /api/gallery/thumbnail/  → gallery.api.views                             │   │
│  │                                                                             │   │
│  │   /api/livestream/         → livestream.api.views                          │   │
│  │   /api/livestream/calendar/→ livestream.api.views                          │   │
│  │                                                                             │   │
│  │   /api/songlist/*          → songlist.api.views                            │   │
│  │                                                                             │   │
│  │   /admin/                  → Django Admin                                  │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 六、技术选型说明

### 6.1 为什么选择这些技术？

| 技术 | 选择理由 |
|------|----------|
| **React + TypeScript** | 类型安全、组件化开发、大型生态、优秀的开发体验 |
| **Django + DRF** | Python 生态、快速开发、强大的 Admin、丰富的第三方库 |
| **SQLite** | 轻量级、零配置、适合中小型项目、备份简单 |
| **Nginx** | 高性能、低资源占用、强大的反向代理和静态文件服务能力 |
| **Gunicorn** | WSGI HTTP 服务器、与 Django 配合良好、支持多工作进程 |
| **systemd** | Linux 标准进程管理、内置定时任务支持 |

### 6.2 可扩展性设计

```
┌─────────────────────────────────────────────────────────────────┐
│                        水平扩展能力                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  当前架构 ──────▶  扩展方案                                      │
│                                                                 │
│  ┌─────────┐      ┌─────────┐     ┌─────────┐                  │
│  │  Nginx  │─────▶│  Nginx  │────▶│  Nginx  │  (负载均衡层)      │
│  └────┬────┘      └────┬────┘     └────┬────┘                  │
│       │                │               │                        │
│       ▼                ▼               ▼                        │
│  ┌─────────┐      ┌─────────┐     ┌─────────┐                  │
│  │ Gunicorn│      │Gunicorn │     │Gunicorn │  (应用层扩展)      │
│  │ + Django│      │+ Django │     │+ Django │                  │
│  └────┬────┘      └────┬────┘     └────┬────┘                  │
│       │                │               │                        │
│       └────────────────┴───────────────┘                        │
│                        │                                        │
│                        ▼                                        │
│                 ┌─────────────┐                                 │
│                 │ MySQL /     │  (数据库扩展)                    │
│                 │ PostgreSQL  │                                 │
│                 └─────────────┘                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 七、总结

XXM Fans Home 项目采用经典的分层架构设计：

1. **前端**：React + TypeScript + DDD 架构，清晰的职责分离
2. **后端**：Django + DRF 分层架构，模型-服务-API 分离
3. **部署**：Nginx + Gunicorn 经典组合，systemd 管理定时任务
4. **存储**：SQLite + 文件系统，简单高效

整体架构简洁清晰，易于维护和扩展，适合中小型项目的快速开发和部署。
