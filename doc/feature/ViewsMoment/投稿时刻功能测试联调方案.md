# 投稿时刻功能 - 测试联调方案

## 一、测试概述

### 1.1 测试目标
确保"投稿时刻"功能从前端到后端的完整链路正常运行，包括 API 接口、数据展示、用户交互和异常处理等各个方面。

### 1.2 测试范围
- **后端 API 测试**：接口功能、性能、安全性
- **前端功能测试**：UI 展示、用户交互、数据处理
- **集成测试**：前后端联调、端到端测试
- **性能测试**：加载性能、响应时间、并发处理
- **兼容性测试**：浏览器兼容性、设备兼容性

### 1.3 测试环境
- **开发环境**：http://localhost:8080
- **测试环境**：待部署
- **生产环境**：https://www.xxm8777.cn

---

## 二、测试准备

### 2.1 环境搭建

#### 2.1.1 后端环境
```bash
# 进入后端目录
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend

# 激活虚拟环境
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 运行数据库迁移
python manage.py migrate

# 启动开发服务器
python manage.py runserver 0.0.0.0:8000
```

#### 2.1.2 前端环境
```bash
# 进入前端目录
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

#### 2.1.3 Nginx 配置
```bash
# 启动 Nginx
nginx -c /home/yifeianyi/Desktop/xxm_fans_home/infra/nginx/xxm_nginx.conf -p /tmp/nginx
```

### 2.2 测试数据准备

#### 2.2.1 创建测试数据脚本
**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/tools/create_test_submission_data.py`

```python
import os
import sys
import django
from datetime import datetime, timedelta

# 添加项目路径
sys.path.insert(0, '/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend')

# 设置 Django 环境
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'xxm_fans_home.settings')
django.setup()

from data_analytics.models.work_static import WorkStatic


def create_test_submission_data(start_year=2022, end_year=2024):
    """
    创建测试投稿数据

    Args:
        start_year: 起始年份（默认 2022）
        end_year: 结束年份（默认 2024）
    """
    print(f"开始创建测试投稿数据（{start_year}-{end_year}）...")

    # 清空现有数据
    WorkStatic.objects.all().delete()
    print("已清空现有数据")

    # 创建指定年份范围的测试数据
    start_date = datetime(start_year, 1, 1)
    end_date = datetime(end_year, 2, 28)

    current_date = start_date
    submission_count = 0

    while current_date <= end_date:
        # 每个月随机创建 5-15 条投稿
        monthly_count = (current_date.month % 3) * 5 + 5

        for i in range(monthly_count):
            # 随机生成投稿日期
            submission_day = (i * 2) % 28 + 1
            submission_date = datetime(
                current_date.year,
                current_date.month,
                submission_day,
                10 + (i % 12),  # 10:00 - 21:00
                (i * 5) % 60
            )

            # 创建投稿记录
            WorkStatic.objects.create(
                platform='bilibili',
                work_id=f'BV{(submission_count + 1):012d}',
                title=f'测试投稿-{current_date.year}年{current_date.month}月{submission_day}日',
                author='咻咻满',
                publish_time=submission_date,
                cover_url=f'/media/data_analytics/covers/test_{submission_count + 1}.jpg',
                is_valid=(i % 10 != 0)  # 每 10 条中有 1 条无效
            )

            submission_count += 1

        current_date = (current_date.replace(day=1) + timedelta(days=32)).replace(day=1)

    print(f"测试数据创建完成！共创建 {submission_count} 条投稿记录")


if __name__ == '__main__':
    # 可以根据需要指定年份范围
    create_test_submission_data(start_year=2022, end_year=2024)
    # 或者使用默认参数
    # create_test_submission_data()
```

#### 2.2.2 运行测试数据脚本
```bash
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend
python tools/create_test_submission_data.py
```

---

## 三、后端 API 测试

### 3.1 单元测试

#### 3.1.1 测试文件结构
```
repo/xxm_fans_backend/data_analytics/tests/
├── __init__.py
├── test_submission_api.py        # API 接口测试
├── test_submission_service.py    # 业务逻辑测试
└── test_submission_models.py     # 模型测试
```

#### 3.1.2 API 接口测试

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/data_analytics/tests/test_submission_api.py`

```python
import json
from django.test import TestCase, Client
from django.utils import timezone
from datetime import datetime
from data_analytics.models.work_static import WorkStatic


class MonthlySubmissionStatsAPITestCase(TestCase):
    """月度投稿统计 API 测试"""

    def setUp(self):
        """设置测试数据"""
        self.client = Client()

        # 创建 2024 年 1 月的测试数据
        WorkStatic.objects.create(
            platform='bilibili',
            work_id='BV1234567890',
            title='测试作品1',
            author='咻咻满',
            publish_time=timezone.make_aware(datetime(2024, 1, 5, 10, 30)),
            is_valid=True
        )
        WorkStatic.objects.create(
            platform='bilibili',
            work_id='BV0987654321',
            title='测试作品2',
            author='咻咻满',
            publish_time=timezone.make_aware(datetime(2024, 1, 10, 14, 20)),
            is_valid=False
        )

    def test_monthly_submission_stats_success(self):
        """测试成功获取月度投稿统计"""
        response = self.client.get('/api/data-analytics/submissions/monthly/?year=2024')

        self.assertEqual(response.status_code, 200)
        data = json.loads(response.content)

        self.assertEqual(data['code'], 200)
        self.assertEqual(data['data']['year'], 2024)
        self.assertEqual(len(data['data']['monthly_stats']), 1)

        stats = data['data']['monthly_stats'][0]
        self.assertEqual(stats['month'], 1)
        self.assertEqual(stats['total'], 2)
        self.assertEqual(stats['valid'], 1)
        self.assertEqual(stats['invalid'], 1)

    def test_monthly_submission_stats_invalid_year(self):
        """测试无效年份参数"""
        response = self.client.get('/api/data-analytics/submissions/monthly/?year=invalid')

        self.assertEqual(response.status_code, 400)
        data = json.loads(response.content)

        self.assertEqual(data['code'], 400)
        self.assertIn('年份必须为整数', data['message'])

    def test_monthly_submission_stats_no_data(self):
        """测试无数据情况"""
        response = self.client.get('/api/data-analytics/submissions/monthly/?year=2025')

        self.assertEqual(response.status_code, 200)
        data = json.loads(response.content)

        self.assertEqual(data['code'], 200)
        self.assertEqual(len(data['data']['monthly_stats']), 0)


class MonthlySubmissionRecordsAPITestCase(TestCase):
    """月度投稿记录 API 测试"""

    def setUp(self):
        """设置测试数据"""
        self.client = Client()

        # 创建测试数据
        for i in range(25):  # 创建 25 条记录，测试分页
            WorkStatic.objects.create(
                platform='bilibili',
                work_id=f'BV{i:012d}',
                title=f'测试作品{i}',
                author='咻咻满',
                publish_time=timezone.make_aware(datetime(2024, 1, (i % 28) + 1, 10, 30)),
                is_valid=(i % 10 != 0)
            )

    def test_monthly_submission_records_success(self):
        """测试成功获取月度投稿记录"""
        response = self.client.get('/api/data-analytics/submissions/monthly/2024/1/')

        self.assertEqual(response.status_code, 200)
        data = json.loads(response.content)

        self.assertEqual(data['code'], 200)
        self.assertEqual(data['data']['year'], 2024)
        self.assertEqual(data['data']['month'], 1)
        self.assertEqual(len(data['data']['records']), 20)  # 默认每页 20 条

        pagination = data['data']['pagination']
        self.assertEqual(pagination['total'], 25)
        self.assertEqual(pagination['page'], 1)
        self.assertEqual(pagination['page_size'], 20)
        self.assertEqual(pagination['total_pages'], 2)

    def test_monthly_submission_records_pagination(self):
        """测试分页功能"""
        # 第一页
        response1 = self.client.get('/api/data-analytics/submissions/monthly/2024/1/?page=1&page_size=10')
        data1 = json.loads(response1.content)
        self.assertEqual(len(data1['data']['records']), 10)

        # 第二页
        response2 = self.client.get('/api/data-analytics/submissions/monthly/2024/1/?page=2&page_size=10')
        data2 = json.loads(response2.content)
        self.assertEqual(len(data2['data']['records']), 10)

        # 第三页
        response3 = self.client.get('/api/data-analytics/submissions/monthly/2024/1/?page=3&page_size=10')
        data3 = json.loads(response3.content)
        self.assertEqual(len(data3['data']['records']), 5)

    def test_monthly_submission_records_filter_valid(self):
        """测试有效投稿筛选"""
        response = self.client.get('/api/data-analytics/submissions/monthly/2024/1/?is_valid=true')
        data = json.loads(response.content)

        # 25 条记录中，有 23 条有效（每 10 条中有 1 条无效）
        self.assertEqual(len(data['data']['records']), 23)

    def test_monthly_submission_records_filter_invalid(self):
        """测试无效投稿筛选"""
        response = self.client.get('/api/data-analytics/submissions/monthly/2024/1/?is_valid=false')
        data = json.loads(response.content)

        # 25 条记录中，有 2 条无效
        self.assertEqual(len(data['data']['records']), 2)


class YearsSubmissionOverviewAPITestCase(TestCase):
    """年度投稿概览 API 测试"""

    def setUp(self):
        """设置测试数据"""
        self.client = Client()

        # 创建 2021-2024 年的测试数据
        for year in range(2021, 2025):
            for month in range(1, 13):
                WorkStatic.objects.create(
                    platform='bilibili',
                    work_id=f'BV{year}{month:02d}000000000',
                    title=f'测试作品-{year}-{month}',
                    author='咻咻满',
                    publish_time=timezone.make_aware(datetime(year, month, 15, 10, 30)),
                    is_valid=True
                )

    def test_years_submission_overview_success(self):
        """测试成功获取年度投稿概览（动态年份）"""
        response = self.client.get('/api/data-analytics/submissions/years/')

        self.assertEqual(response.status_code, 200)
        data = json.loads(response.content)

        self.assertEqual(data['code'], 200)
        # 验证返回的年份是数据库中实际存在的年份（2021-2024）
        self.assertEqual(len(data['data']['years']), 4)

        # 验证每年的数据
        for i, year_data in enumerate(data['data']['years']):
            expected_year = 2021 + i
            self.assertEqual(year_data['year'], expected_year)
            self.assertEqual(year_data['total_submissions'], 12)
            self.assertEqual(year_data['valid_submissions'], 12)
            self.assertEqual(year_data['active_months'], 12)

    def test_years_submission_overview_dynamic_range(self):
        """测试动态年份范围（不指定参数）"""
        response = self.client.get('/api/data-analytics/submissions/years/')
        data = json.loads(response.content)

        # 验证返回了数据库中所有可用的年份
        years_list = [y['year'] for y in data['data']['years']]
        self.assertIn(2021, years_list)
        self.assertIn(2022, years_list)
        self.assertIn(2023, years_list)
        self.assertIn(2024, years_list)

    def test_years_submission_overview_custom_range(self):
        """测试自定义年份范围筛选"""
        response = self.client.get('/api/data-analytics/submissions/years/?start_year=2022&end_year=2023')
        data = json.loads(response.content)

        self.assertEqual(len(data['data']['years']), 2)
        self.assertEqual(data['data']['years'][0]['year'], 2022)
        self.assertEqual(data['data']['years'][1]['year'], 2023)
```

#### 3.1.3 运行单元测试
```bash
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend

# 运行所有测试
python manage.py test data_analytics.tests

# 运行特定测试文件
python manage.py test data_analytics.tests.test_submission_api

# 运行特定测试用例
python manage.py test data_analytics.tests.test_submission_api.MonthlySubmissionStatsAPITestCase.test_monthly_submission_stats_success

# 生成测试覆盖率报告
pip install coverage
coverage run --source='.' manage.py test data_analytics.tests
coverage report
coverage html
```

### 3.2 API 接口手动测试

#### 3.2.1 使用 curl 测试

```bash
# 测试月度投稿统计接口
curl -X GET "http://localhost:8000/api/data-analytics/submissions/monthly/?year=2024"

# 测试月度投稿记录接口
curl -X GET "http://localhost:8000/api/data-analytics/submissions/monthly/2024/1/"

# 测试带参数的月度投稿记录接口
curl -X GET "http://localhost:8000/api/data-analytics/submissions/monthly/2024/1/?page=1&page_size=10&is_valid=true"

# 测试年度投稿概览接口
curl -X GET "http://localhost:8000/api/data-analytics/submissions/years/"

# 测试带日期范围的年度投稿概览接口
curl -X GET "http://localhost:8000/api/data-analytics/submissions/years/?start_year=2021&end_year=2024"
```

#### 3.2.2 使用 Postman 测试

创建 Postman Collection，包含以下测试用例：

1. **月度投稿统计**
   - Method: GET
   - URL: `{{base_url}}/api/data-analytics/submissions/monthly/`
   - Params:
     - year: 2024
     - platform: bilibili

2. **月度投稿记录**
   - Method: GET
   - URL: `{{base_url}}/api/data-analytics/submissions/monthly/2024/1/`
   - Params:
     - platform: bilibili
     - is_valid: true
     - page: 1
     - page_size: 20

3. **年度投稿概览**
   - Method: GET
   - URL: `{{base_url}}/api/data-analytics/submissions/years/`
   - Params:
     - platform: bilibili
     - start_year: 2021
     - end_year: 2024

### 3.3 性能测试

#### 3.3.1 使用 Locust 进行性能测试

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/test/locust_submission.py`

```python
from locust import HttpUser, task, between
import random


class SubmissionUser(HttpUser):
    """投稿时刻功能性能测试用户"""

    wait_time = between(1, 3)

    @task(3)
    def get_monthly_stats(self):
        """获取月度投稿统计"""
        year = random.randint(2021, 2024)
        self.client.get(f"/api/data-analytics/submissions/monthly/?year={year}")

    @task(2)
    def get_monthly_records(self):
        """获取月度投稿记录"""
        year = random.randint(2021, 2024)
        month = random.randint(1, 12)
        self.client.get(f"/api/data-analytics/submissions/monthly/{year}/{month}/")

    @task(1)
    def get_years_overview(self):
        """获取年度投稿概览"""
        self.client.get("/api/data-analytics/submissions/years/")
```

#### 3.3.2 运行性能测试
```bash
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/test

# 运行 Locust
locust -f locust_submission.py --host=http://localhost:8000

# 访问 Locust Web UI
# http://localhost:8089
```

#### 3.3.3 性能指标
- **响应时间**：P95 < 500ms，P99 < 1000ms
- **吞吐量**：> 100 req/s
- **错误率**：< 0.1%
- **并发用户**：支持 100+ 并发用户

---

## 四、前端功能测试

### 4.1 单元测试

#### 4.1.1 测试文件结构
```
repo/xxm_fans_frontend/src/
└── __tests__/
    ├── components/
    │   └── TimelineChart.test.tsx    # TimelineChart 组件测试
    ├── services/
    │   └── RealSubmissionService.test.ts  # 服务测试
    └── utils/
        └── dateUtils.test.ts         # 日期工具测试
```

#### 4.1.2 组件测试

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/src/__tests__/components/TimelineChart.test.tsx`

```typescript
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import TimelineChart from '../../presentation/components/features/TimelineChart';
import * as submissionService from '../../infrastructure/api/RealSubmissionService';

// Mock API 服务
jest.mock('../../infrastructure/api/RealSubmissionService');

describe('TimelineChart 组件测试', () => {
  const mockYears = [2021, 2022, 2023, 2024];

  beforeEach(() => {
    jest.clearAllMocks();
  });

  test('应该正确渲染时间线', async () => {
    // Mock API 响应
    (submissionService.realSubmissionService.getMonthlySubmissionStats as jest.Mock)
      .mockResolvedValue({
        year: 2024,
        platform: null,
        monthly_stats: [
          {
            month: 1,
            total: 15,
            valid: 14,
            invalid: 1,
            first_submission: '2024-01-05T10:30:00+08:00',
            last_submission: '2024-01-28T18:45:00+08:00'
          }
        ],
        year_summary: {
          total_submissions: 15,
          valid_submissions: 14,
          invalid_submissions: 1,
          active_months: 1
        }
      });

    render(<TimelineChart years={mockYears} />);

    // 等待数据加载
    await waitFor(() => {
      expect(screen.getByText('2021')).toBeInTheDocument();
      expect(screen.getByText('2022')).toBeInTheDocument();
      expect(screen.getByText('2023')).toBeInTheDocument();
      expect(screen.getByText('2024')).toBeInTheDocument();
    });
  });

  test('应该正确显示加载状态', () => {
    render(<TimelineChart years={mockYears} />);

    expect(screen.getByText('加载统计数据中...')).toBeInTheDocument();
  });

  test('应该正确处理月份点击', async () => {
    // Mock API 响应
    (submissionService.realSubmissionService.getMonthlySubmissionStats as jest.Mock)
      .mockResolvedValue({
        year: 2024,
        platform: null,
        monthly_stats: [
          {
            month: 1,
            total: 15,
            valid: 14,
            invalid: 1,
            first_submission: '2024-01-05T10:30:00+08:00',
            last_submission: '2024-01-28T18:45:00+08:00'
          }
        ],
        year_summary: {
          total_submissions: 15,
          valid_submissions: 14,
          invalid_submissions: 1,
          active_months: 1
        }
      });

    (submissionService.realSubmissionService.getMonthlySubmissionRecords as jest.Mock)
      .mockResolvedValue({
        year: 2024,
        month: 1,
        platform: null,
        records: [
          {
            id: 1,
            platform: 'bilibili',
            work_id: 'BV1234567890',
            title: '测试作品',
            author: '咻咻满',
            publish_time: '2024-01-05T10:30:00+08:00',
            cover_url: '/media/data_analytics/covers/test.jpg',
            cover_thumbnail_url: '/media/data_analytics/covers/thumbnails/test_thumb.jpg',
            is_valid: true,
            video_url: 'https://www.bilibili.com/video/BV1234567890',
            video_embed_url: 'https://player.bilibili.com/player.html?bvid=BV1234567890'
          }
        ],
        pagination: {
          total: 1,
          page: 1,
          page_size: 20,
          total_pages: 1
        }
      });

    render(<TimelineChart years={mockYears} />);

    // 等待数据加载
    await waitFor(() => {
      expect(screen.getByText('2024')).toBeInTheDocument();
    });

    // 点击月份
    fireEvent.click(screen.getByText('1'));

    // 验证弹窗显示
    await waitFor(() => {
      expect(screen.getByText('2024年1月投稿记录')).toBeInTheDocument();
    });
  });

  test('应该正确处理错误状态', async () => {
    // Mock API 错误
    (submissionService.realSubmissionService.getMonthlySubmissionStats as jest.Mock)
      .mockRejectedValue(new Error('网络错误'));

    render(<TimelineChart years={mockYears} />);

    // 等待错误显示
    await waitFor(() => {
      expect(screen.getByText('加载统计数据失败，请稍后重试')).toBeInTheDocument();
    });
  });
});
```

#### 4.1.3 运行前端测试
```bash
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend

# 运行所有测试
npm test

# 运行特定测试文件
npm test TimelineChart.test.tsx

# 生成测试覆盖率报告
npm test -- --coverage

# 交互式测试模式
npm test -- --watch
```

### 4.2 手动测试

#### 4.2.1 功能测试清单

| 测试项 | 测试步骤 | 预期结果 |
|--------|---------|---------|
| 页面加载 | 访问 http://localhost:8080/songs，切换到"投稿时刻" Tab | 正确显示时间线组件 |
| 年份动态加载 | 观察时间线显示的年份 | 年份根据后端数据库实际数据动态显示（如 2022-2024） |
| 数据加载 | 观察时间线数据 | 正确显示所有可用年份的月度统计 |
| 月份悬停 | 鼠标悬停在有投稿的月份上 | 显示该月的投稿统计信息 |
| 月份点击 | 点击有投稿的月份 | 弹出该月的投稿记录详情 |
| 详情弹窗 | 查看弹窗内容 | 正确显示投稿总数、有效投稿、无效投稿 |
| 投稿记录 | 查看投稿记录列表 | 正确显示封面、标题、日期等信息 |
| 视频播放 | 点击投稿记录的播放按钮 | 弹出视频播放器 |
| 视频关闭 | 点击视频播放器的关闭按钮 | 关闭视频播放器 |
| 弹窗关闭 | 点击弹窗外部或关闭按钮 | 关闭详情弹窗 |
| 空状态处理 | 点击无投稿的月份 | 无响应 |
| 错误处理 | 模拟网络错误 | 显示友好的错误提示 |
| 加载状态 | 刷新页面 | 显示加载动画 |
| 分页功能 | 投稿记录超过 20 条 | 支持分页加载 |

#### 4.2.2 浏览器兼容性测试

| 浏览器 | 版本 | 测试结果 |
|--------|------|---------|
| Chrome | 最新版 | 待测试 |
| Firefox | 最新版 | 待测试 |
| Safari | 最新版 | 待测试 |
| Edge | 最新版 | 待测试 |
| Mobile Safari | iOS 14+ | 待测试 |
| Chrome Mobile | Android 10+ | 待测试 |

#### 4.2.3 响应式测试

| 设备类型 | 分辨率 | 测试结果 |
|---------|--------|---------|
| 桌面端 | 1920x1080 | 待测试 |
| 桌面端 | 1366x768 | 待测试 |
| 平板端 | 768x1024 | 待测试 |
| 手机端 | 375x667 | 待测试 |
| 手机端 | 414x896 | 待测试 |

---

## 五、集成测试

### 5.1 端到端测试

#### 5.1.1 使用 Cypress 进行 E2E 测试

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/cypress/e2e/submission.cy.ts`

```typescript
describe('投稿时刻功能端到端测试', () => {
  beforeEach(() => {
    cy.visit('http://localhost:8080/songs');
  });

  it('应该正确显示投稿时刻页面', () => {
    // 切换到投稿时刻 Tab
    cy.contains('投稿时刻').click();

    // 验证页面标题
    cy.contains('投稿时刻').should('be.visible');
    cy.contains('记录每一次重要的投稿时刻').should('be.visible');
  });

  it('应该正确加载和显示时间线数据', () => {
    // 切换到投稿时刻 Tab
    cy.contains('投稿时刻').click();

    // 等待数据加载（验证至少有一个年份显示）
    cy.get('.timeline-year-label', { timeout: 10000 }).should('exist');

    // 验证年份是根据数据库动态显示的（至少有一个年份）
    cy.get('.timeline-year-label').should('have.length.greaterThan', 0);
  });

  it('应该正确处理月份点击和详情展示', () => {
    // 切换到投稿时刻 Tab
    cy.contains('投稿时刻').click();

    // 等待数据加载
    cy.get('.timeline-year-label', { timeout: 10000 }).should('exist');

    // 找到第一个有投稿的月份并点击
    cy.get('.timeline-month.active').first().click();

    // 验证详情弹窗显示
    cy.contains('投稿记录', { timeout: 5000 }).should('be.visible');
  });

  it('应该正确播放视频', () => {
    // 切换到投稿时刻 Tab
    cy.contains('投稿时刻').click();

    // 等待数据加载
    cy.get('.timeline-year-label', { timeout: 10000 }).should('exist');

    // 找到第一个有投稿的月份并点击
    cy.get('.timeline-month.active').first().click();

    // 点击视频播放按钮
    cy.get('.play-button').first().click();

    // 验证视频播放器显示
    cy.get('iframe').should('be.visible');
  });
});
```

#### 5.1.2 运行 E2E 测试
```bash
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend

# 安装 Cypress
npm install cypress --save-dev

# 打开 Cypress 浏览器
npx cypress open

# 运行测试（无头模式）
npx cypress run
```

### 5.2 前后端联调测试

#### 5.2.1 联调测试清单

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 月度统计加载 | 前端请求月度统计 API | 后端返回正确数据 | 待测试 |
| 月度记录加载 | 前端请求月度记录 API | 后端返回正确数据 | 待测试 |
| 年度概览加载 | 前端请求年度概览 API | 后端返回正确数据 | 待测试 |
| 数据格式验证 | 验证 API 响应格式 | 符合接口文档规范 | 待测试 |
| 错误处理 | 模拟后端错误 | 前端显示友好提示 | 待测试 |
| 缓存机制 | 多次请求同一数据 | 使用缓存，减少请求 | 待测试 |
| 分页功能 | 加载超过 20 条记录 | 正确分页 | 待测试 |
| 筛选功能 | 使用筛选参数 | 返回筛选后的数据 | 待测试 |

#### 5.2.2 联调测试步骤

1. **启动后端服务**
   ```bash
   cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend
   python manage.py runserver 0.0.0.0:8000
   ```

2. **启动前端服务**
   ```bash
   cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend
   npm run dev
   ```

3. **访问应用**
   ```
   http://localhost:8080/songs
   ```

4. **执行联调测试**
   - 切换到"投稿时刻" Tab
   - 验证数据加载
   - 测试各项功能
   - 记录测试结果

---

## 六、测试报告

### 6.1 测试结果记录

| 测试类型 | 测试用例数 | 通过数 | 失败数 | 通过率 |
|---------|-----------|--------|--------|--------|
| 后端单元测试 | 待统计 | 待统计 | 待统计 | 待计算 |
| 后端 API 测试 | 待统计 | 待统计 | 待统计 | 待计算 |
| 前端单元测试 | 待统计 | 待统计 | 待统计 | 待计算 |
| 前端功能测试 | 待统计 | 待统计 | 待统计 | 待计算 |
| 集成测试 | 待统计 | 待统计 | 待统计 | 待计算 |
| 性能测试 | 待统计 | 待统计 | 待统计 | 待计算 |

### 6.2 问题跟踪

| 问题编号 | 问题描述 | 严重程度 | 状态 | 负责人 |
|---------|---------|---------|------|--------|
| - | - | - | - | - |

### 6.3 测试结论

待测试完成后填写。

---

## 七、测试验收标准

### 7.1 功能验收标准
- [ ] 所有 API 接口正常工作
- [ ] 前端页面正确展示数据
- [ ] 用户交互流畅无卡顿
- [ ] 视频播放功能正常
- [ ] 错误处理机制完善

### 7.2 性能验收标准
- [ ] 首页加载时间 < 2s
- [ ] API 响应时间 P95 < 500ms
- [ ] 支持 100+ 并发用户
- [ ] 内存占用合理

### 7.3 兼容性验收标准
- [ ] 支持主流浏览器
- [ ] 支持移动端访问
- [ ] 响应式布局正常

### 7.4 安全验收标准
- [ ] 无 SQL 注入漏洞
- [ ] 无 XSS 攻击风险
- [ ] 敏感数据不泄露
- [ ] API 访问控制完善

---

## 八、测试工具

### 8.1 后端测试工具
- **unittest**：Python 单元测试框架
- **pytest**：更强大的 Python 测试框架
- **coverage**：代码覆盖率工具
- **Locust**：性能测试工具
- **Postman**：API 测试工具

### 8.2 前端测试工具
- **Jest**：JavaScript 测试框架
- **React Testing Library**：React 组件测试
- **Cypress**：端到端测试
- **Lighthouse**：性能测试

### 8.3 调试工具
- **Chrome DevTools**：浏览器开发者工具
- **Django Debug Toolbar**：Django 调试工具
- **React DevTools**：React 开发者工具

---

## 九、测试计划时间表

| 阶段 | 任务 | 预计时间 | 负责人 | 状态 |
|------|------|---------|--------|------|
| 准备阶段 | 环境搭建、数据准备 | 0.5 天 | - | 待开始 |
| 后端测试 | 单元测试、API 测试、性能测试 | 1 天 | - | 待开始 |
| 前端测试 | 单元测试、功能测试、兼容性测试 | 1 天 | - | 待开始 |
| 集成测试 | 端到端测试、前后端联调 | 1 天 | - | 待开始 |
| 问题修复 | 修复测试中发现的问题 | 0.5 天 | - | 待开始 |
| 回归测试 | 验证问题修复 | 0.5 天 | - | 待开始 |
| 测试报告 | 汇总测试结果 | 0.5 天 | - | 待开始 |
| **总计** | | **4.5 天** | | |

---

## 十、总结

本测试联调方案提供了完整的测试策略和执行计划，涵盖：

1. **测试准备**：环境搭建、数据准备
2. **后端测试**：单元测试、API 测试、性能测试
3. **前端测试**：单元测试、功能测试、兼容性测试
4. **集成测试**：端到端测试、前后端联调
5. **测试报告**：结果记录、问题跟踪
6. **验收标准**：功能、性能、兼容性、安全
7. **测试工具**：推荐使用的测试工具
8. **测试计划**：详细的时间表和任务分配

预计测试时间：4.5 天

测试完成后，确保"投稿时刻"功能从前端到后端的完整链路正常运行，为用户提供流畅的使用体验。