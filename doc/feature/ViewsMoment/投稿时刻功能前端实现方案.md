# 投稿时刻功能 - 前端实现方案

## 一、实现概述

### 1.1 实现目标
基于现有的 React + TypeScript 前端架构，将"投稿时刻"功能的 TimelineChart 组件从 Mock 数据迁移到真实后端 API，实现完整的数据展示和交互功能。

### 1.2 技术栈
- **框架**：React 19.2.3 + TypeScript 5.8.2
- **构建工具**：Vite 6.2.0
- **状态管理**：React Hooks
- **HTTP 客户端**：Fetch API
- **架构模式**：DDD 三层架构

### 1.3 文件结构
```
repo/xxm_fans_frontend/
├── domain/
│   ├── types.ts                          # 类型定义（需更新）
│   └── api/
│       └── ISubmissionService.ts         # 投稿服务接口（需新增）
├── infrastructure/
│   ├── api/
│   │   ├── apiTypes.ts                   # API 类型定义（需更新）
│   │   └── RealSubmissionService.ts      # 真实投稿服务实现（需新增）
│   └── config/
│       └── config.ts                     # 配置文件（无需修改）
└── presentation/
    ├── components/
    │   └── features/
    │       └── TimelineChart.tsx         # 时间线组件（需更新）
    └── pages/
        └── SongsPage.tsx                 # 歌曲页面（无需修改）
```

---

## 二、实现步骤

### 2.1 更新领域层类型定义

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/domain/types.ts`

在现有类型定义中添加投稿时刻相关类型：

```typescript
// ==================== 投稿时刻相关类型 ====================

/** 月度投稿统计 */
export interface MonthlyStats {
  month: number;
  total: number;
  valid: number;
  invalid: number;
  first_submission: string;
  last_submission: string;
}

/** 年度汇总统计 */
export interface YearSummary {
  total_submissions: number;
  valid_submissions: number;
  invalid_submissions: number;
  active_months: number;
}

/** 月度投稿统计响应 */
export interface MonthlySubmissionStatsResponse {
  year: number;
  platform: string | null;
  monthly_stats: MonthlyStats[];
  year_summary: YearSummary;
}

/** 投稿记录 */
export interface SubmissionRecord {
  id: number;
  platform: string;
  work_id: string;
  title: string;
  author: string;
  publish_time: string;
  cover_url: string;
  cover_thumbnail_url: string | null;
  is_valid: boolean;
  video_url: string;
  video_embed_url: string;
}

/** 分页信息 */
export interface PaginationInfo {
  total: number;
  page: number;
  page_size: number;
  total_pages: number;
}

/** 月度投稿记录响应 */
export interface MonthlySubmissionRecordsResponse {
  year: number;
  month: number;
  platform: string | null;
  records: SubmissionRecord[];
  pagination: PaginationInfo;
}

/** 年度统计 */
export interface YearStats {
  year: number;
  total_submissions: number;
  valid_submissions: number;
  invalid_submissions: number;
  active_months: number;
  first_submission: string;
  last_submission: string;
}

/** 年度汇总 */
export interface YearsSummary {
  total_years: number;
  total_submissions: number;
  valid_submissions: number;
  invalid_submissions: number;
}

/** 年度投稿概览响应 */
export interface YearsSubmissionOverviewResponse {
  platform: string | null;
  years: YearStats[];
  summary: YearsSummary;
}

/** 投稿统计查询参数 */
export interface MonthlyStatsParams {
  year: number;
  platform?: string;
}

/** 投稿记录查询参数 */
export interface MonthlyRecordsParams {
  year: number;
  month: number;
  platform?: string;
  is_valid?: boolean;
  page?: number;
  page_size?: number;
}

/** 年度概览查询参数 */
export interface YearsOverviewParams {
  platform?: string;
  start_year?: number;
  end_year?: number;
}
```

---

### 2.2 创建投稿服务接口

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/domain/api/ISubmissionService.ts`

```typescript
import {
  MonthlySubmissionStatsResponse,
  MonthlySubmissionRecordsResponse,
  YearsSubmissionOverviewResponse,
  MonthlyStatsParams,
  MonthlyRecordsParams,
  YearsOverviewParams,
} from '../types';

/**
 * 投稿服务接口
 * 定义投稿时刻相关的业务逻辑接口
 */
export interface ISubmissionService {
  /**
   * 获取月度投稿统计
   * @param params 查询参数
   * @returns 月度投稿统计数据
   */
  getMonthlySubmissionStats(
    params: MonthlyStatsParams
  ): Promise<MonthlySubmissionStatsResponse>;

  /**
   * 获取月度投稿记录
   * @param params 查询参数
   * @returns 月度投稿记录数据
   */
  getMonthlySubmissionRecords(
    params: MonthlyRecordsParams
  ): Promise<MonthlySubmissionRecordsResponse>;

  /**
   * 获取年度投稿概览
   * @param params 查询参数
   * @returns 年度投稿概览数据
   */
  getYearsSubmissionOverview(
    params?: YearsOverviewParams
  ): Promise<YearsSubmissionOverviewResponse>;

  /**
   * 清除月度统计缓存
   * @param year 年份
   * @param platform 平台（可选）
   */
  clearMonthlyStatsCache(year: number, platform?: string): Promise<void>;
}
```

---

### 2.3 更新 API 类型定义

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/infrastructure/api/apiTypes.ts`

在现有类型定义中添加：

```typescript
// ==================== API 响应类型 ====================

/** API 统一响应格式 */
export interface ApiResponse<T = any> {
  code: number;
  message: string;
  data: T;
}

/** API 错误响应 */
export interface ApiError {
  code: number;
  message: string;
  data: null;
}

/** 投稿时刻 API 响应类型 */
export type SubmissionStatsApiResponse = ApiResponse<MonthlySubmissionStatsResponse>;
export type SubmissionRecordsApiResponse = ApiResponse<MonthlySubmissionRecordsResponse>;
export type YearsOverviewApiResponse = ApiResponse<YearsSubmissionOverviewResponse>;
```

---

### 2.4 创建真实投稿服务实现

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/infrastructure/api/RealSubmissionService.ts`

```typescript
import {
  ISubmissionService,
  MonthlySubmissionStatsResponse,
  MonthlySubmissionRecordsResponse,
  YearsSubmissionOverviewResponse,
  MonthlyStatsParams,
  MonthlyRecordsParams,
  YearsOverviewParams,
} from '../../domain/api/ISubmissionService';
import { config } from '../config/config';
import type {
  ApiResponse,
  ApiError,
} from './apiTypes';

/**
 * 真实投稿服务实现
 * 实现投稿时刻相关的 API 调用
 */
class RealSubmissionService implements ISubmissionService {
  private baseURL = config.api.baseURL;
  private apiPath = 'data-analytics/submissions';

  /**
   * 通用 API 请求方法
   */
  private async request<T>(
    endpoint: string,
    options: RequestInit = {}
  ): Promise<T> {
    const url = `${this.baseURL}/${this.apiPath}/${endpoint}`;

    try {
      const response = await fetch(url, {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          ...options.headers,
        },
      });

      const data: ApiResponse<T> = await response.json();

      if (!response.ok || data.code !== 200) {
        throw new Error(data.message || '请求失败');
      }

      return data.data;
    } catch (error) {
      console.error('API 请求失败:', error);
      throw error;
    }
  }

  /**
   * 获取月度投稿统计
   */
  async getMonthlySubmissionStats(
    params: MonthlyStatsParams
  ): Promise<MonthlySubmissionStatsResponse> {
    const queryParams = new URLSearchParams({
      year: params.year.toString(),
    });

    if (params.platform) {
      queryParams.append('platform', params.platform);
    }

    return this.request<MonthlySubmissionStatsResponse>(
      `monthly/?${queryParams.toString()}`
    );
  }

  /**
   * 获取月度投稿记录
   */
  async getMonthlySubmissionRecords(
    params: MonthlyRecordsParams
  ): Promise<MonthlySubmissionRecordsResponse> {
    const { year, month, platform, is_valid, page = 1, page_size = 20 } = params;

    const queryParams = new URLSearchParams({
      page: page.toString(),
      page_size: page_size.toString(),
    });

    if (platform) {
      queryParams.append('platform', platform);
    }

    if (is_valid !== undefined) {
      queryParams.append('is_valid', is_valid.toString());
    }

    return this.request<MonthlySubmissionRecordsResponse>(
      `monthly/${year}/${month}/?${queryParams.toString()}`
    );
  }

  /**
   * 获取年度投稿概览
   */
  async getYearsSubmissionOverview(
    params?: YearsOverviewParams
  ): Promise<YearsSubmissionOverviewResponse> {
    const queryParams = new URLSearchParams();

    if (params?.platform) {
      queryParams.append('platform', params.platform);
    }

    if (params?.start_year) {
      queryParams.append('start_year', params.start_year.toString());
    }

    if (params?.end_year) {
      queryParams.append('end_year', params.end_year.toString());
    }

    const queryString = queryParams.toString();
    const endpoint = queryString ? `years/?${queryString}` : 'years/';

    return this.request<YearsSubmissionOverviewResponse>(endpoint);
  }

  /**
   * 清除月度统计缓存
   */
  async clearMonthlyStatsCache(year: number, platform?: string): Promise<void> {
    // 注意：此功能需要后端提供相应的清除缓存接口
    // 如果后端没有提供，可以实现为空操作或使用其他清除缓存策略
    console.log(`清除月度统计缓存: year=${year}, platform=${platform || 'all'}`);
  }
}

// 导出单例
export const realSubmissionService = new RealSubmissionService();
```

---

### 2.5 更新 TimelineChart 组件

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/presentation/components/features/TimelineChart.tsx`

```typescript
import React, { useState, useEffect } from 'react';
import { realSubmissionService } from '../../../infrastructure/api/RealSubmissionService';
import type {
  MonthlySubmissionStatsResponse,
  MonthlySubmissionRecordsResponse,
  SubmissionRecord,
  MonthlyStats,
  YearStats,
} from '../../../domain/types';
import { Play, Calendar, Video, X } from 'lucide-react';

interface TimelineChartProps {
  // 移除固定的 years 属性，改为组件内部动态获取
}

interface SelectedDate {
  year: number;
  month: number;
}

const TimelineChart: React.FC<TimelineChartProps> = () => {
  const [years, setYears] = useState<number[]>([]);
  const [monthlyStats, setMonthlyStats] = useState<Record<number, Record<number, MonthlyStats>>>({});
  const [selectedDate, setSelectedDate] = useState<SelectedDate | null>(null);
  const [monthlyRecords, setMonthlyRecords] = useState<SubmissionRecord[]>([]);
  const [loading, setLoading] = useState(false);
  const [loadingStats, setLoadingStats] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [selectedVideo, setSelectedVideo] = useState<SubmissionRecord | null>(null);

  // 加载所有年份和月度统计数据
  useEffect(() => {
    const loadAllStats = async () => {
      setLoadingStats(true);
      setError(null);

      try {
        // 1. 首先获取所有可用的年份
        const overviewData = await realSubmissionService.getYearsSubmissionOverview();
        const availableYears = overviewData.years.map((y: YearStats) => y.year);
        setYears(availableYears);

        // 2. 并行加载所有年份的月度统计数据
        const stats: Record<number, Record<number, MonthlyStats>> = {};

        const promises = availableYears.map(async (year: number) => {
          const data = await realSubmissionService.getMonthlySubmissionStats({ year });
          return { year, data };
        });

        const results = await Promise.all(promises);

        // 3. 处理结果
        results.forEach(({ year, data }) => {
          stats[year] = {};
          data.monthly_stats.forEach((stat) => {
            stats[year][stat.month] = {
              month: stat.month,
              total: stat.total,
              valid: stat.valid,
              invalid: stat.invalid,
              first_submission: stat.first_submission,
              last_submission: stat.last_submission,
            };
          });
        });

        setMonthlyStats(stats);
      } catch (err) {
        console.error('加载月度统计数据失败:', err);
        setError('加载统计数据失败，请稍后重试');
      } finally {
        setLoadingStats(false);
      }
    };

    loadAllStats();
  }, []); // 移除 years 依赖，因为现在是从 API 获取

  // 加载选中月份的投稿记录
  useEffect(() => {
    if (selectedDate) {
      const fetchMonthlyRecords = async () => {
        setLoading(true);
        setError(null);

        try {
          const data = await realSubmissionService.getMonthlySubmissionRecords({
            year: selectedDate.year,
            month: selectedDate.month,
            page: 1,
            page_size: 100, // 加载该月所有记录
          });

          setMonthlyRecords(data.records);
        } catch (err) {
          console.error('加载月度投稿记录失败:', err);
          setError('加载投稿记录失败，请稍后重试');
        } finally {
          setLoading(false);
        }
      };

      fetchMonthlyRecords();
    }
  }, [selectedDate]);

  // 获取月份的统计数据
  const getMonthStats = (year: number, month: number): MonthlyStats | null => {
    return monthlyStats[year]?.[month] || null;
  };

  // 判断月份是否有投稿
  const hasSubmissions = (year: number, month: number): boolean => {
    const stats = getMonthStats(year, month);
    return stats !== null && stats.total > 0;
  };

  // 获取月份的样式类名
  const getMonthClassName = (year: number, month: number): string => {
    const baseClass = 'timeline-month';
    const hasSub = hasSubmissions(year, month);

    if (hasSub) {
      return `${baseClass} active`;
    }
    return `${baseClass} inactive`;
  };

  // 处理月份点击
  const handleMonthClick = (year: number, month: number) => {
    if (hasSubmissions(year, month)) {
      setSelectedDate({ year, month });
    }
  };

  // 关闭详情弹窗
  const handleCloseModal = () => {
    setSelectedDate(null);
    setMonthlyRecords([]);
  };

  // 打开视频播放器
  const handlePlayVideo = (record: SubmissionRecord) => {
    setSelectedVideo(record);
  };

  // 关闭视频播放器
  const handleCloseVideo = () => {
    setSelectedVideo(null);
  };

  // 渲染年份时间线
  const renderTimeline = () => {
    if (years.length === 0) {
      return (
        <div className="timeline-empty">
          <Video />
          <p>暂无投稿数据</p>
        </div>
      );
    }

    return years.map((year) => (
      <div key={year} className="timeline-year">
        <div className="timeline-year-label">{year}</div>
        <div className="timeline-months">
          {Array.from({ length: 12 }, (_, i) => i + 1).map((month) => (
            <div
              key={month}
              className={getMonthClassName(year, month)}
              onClick={() => handleMonthClick(year, month)}
              title={hasSubmissions(year, month) ? `${month}月: ${getMonthStats(year, month)?.total} 个投稿` : ''}
            >
              <span className="month-number">{month}</span>
            </div>
          ))}
        </div>
      </div>
    ));
  };

  // 渲染月度详情弹窗
  const renderMonthlyDetail = () => {
    if (!selectedDate) return null;

    const stats = getMonthStats(selectedDate.year, selectedDate.month);

    return (
      <div className="timeline-modal-overlay" onClick={handleCloseModal}>
        <div className="timeline-modal-content" onClick={(e) => e.stopPropagation()}>
          <div className="timeline-modal-header">
            <h2>
              <Calendar className="inline-icon" />
              {selectedDate.year}年{selectedDate.month}月投稿记录
            </h2>
            <button className="close-button" onClick={handleCloseModal}>
              <X />
            </button>
          </div>

          {stats && (
            <div className="timeline-modal-stats">
              <div className="stat-item">
                <span className="stat-label">投稿总数:</span>
                <span className="stat-value">{stats.total}</span>
              </div>
              <div className="stat-item">
                <span className="stat-label">有效投稿:</span>
                <span className="stat-value valid">{stats.valid}</span>
              </div>
              <div className="stat-item">
                <span className="stat-label">无效投稿:</span>
                <span className="stat-value invalid">{stats.invalid}</span>
              </div>
            </div>
          )}

          {loading ? (
            <div className="loading-container">
              <div className="spinner"></div>
              <p>加载中...</p>
            </div>
          ) : monthlyRecords.length > 0 ? (
            <div className="timeline-modal-records">
              {monthlyRecords.map((record) => (
                <div key={record.id} className="submission-record-card">
                  <div className="record-cover">
                    {record.cover_thumbnail_url ? (
                      <img
                        src={record.cover_thumbnail_url}
                        alt={record.title}
                        loading="lazy"
                      />
                    ) : record.cover_url ? (
                      <img
                        src={record.cover_url}
                        alt={record.title}
                        loading="lazy"
                      />
                    ) : (
                      <div className="cover-placeholder">
                        <Video />
                      </div>
                    )}
                    <button
                      className="play-button"
                      onClick={() => handlePlayVideo(record)}
                      title="播放视频"
                    >
                      <Play />
                    </button>
                  </div>
                  <div className="record-info">
                    <h3 className="record-title">{record.title}</h3>
                    <p className="record-date">
                      {new Date(record.publish_time).toLocaleDateString('zh-CN')}
                    </p>
                    {!record.is_valid && (
                      <span className="record-badge invalid">无效投稿</span>
                    )}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="empty-state">
              <Video />
              <p>该月暂无投稿记录</p>
            </div>
          )}
        </div>
      </div>
    );
  };

  // 渲染视频播放器
  const renderVideoPlayer = () => {
    if (!selectedVideo) return null;

    return (
      <div className="video-modal-overlay" onClick={handleCloseVideo}>
        <div className="video-modal-content" onClick={(e) => e.stopPropagation()}>
          <div className="video-modal-header">
            <h3>{selectedVideo.title}</h3>
            <button className="close-button" onClick={handleCloseVideo}>
              <X />
            </button>
          </div>
          <div className="video-modal-body">
            <iframe
              src={selectedVideo.video_embed_url}
              allowFullScreen
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            />
          </div>
        </div>
      </div>
    );
  };

  if (loadingStats) {
    return (
      <div className="timeline-container loading">
        <div className="spinner"></div>
        <p>加载统计数据中...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="timeline-container error">
        <Video />
        <p>{error}</p>
        <button onClick={() => window.location.reload()}>重新加载</button>
      </div>
    );
  }

  return (
    <div className="timeline-container">
      <div className="timeline-legend">
        <div className="legend-item">
          <div className="legend-color active"></div>
          <span>有投稿（可点击查看详情）</span>
        </div>
        <div className="legend-item">
          <div className="legend-color inactive"></div>
          <span>无投稿</span>
        </div>
      </div>

      <div className="timeline-scroll">
        {renderTimeline()}
      </div>

      {selectedDate && renderMonthlyDetail()}
      {selectedVideo && renderVideoPlayer()}
    </div>
  );
};

export default TimelineChart;
```

---

### 2.6 添加样式文件

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_frontend/presentation/components/features/TimelineChart.css`

```css
/* TimelineChart 组件样式 */

.timeline-container {
  padding: 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.timeline-container.loading,
.timeline-container.error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 300px;
}

.timeline-container.error {
  color: #ef4444;
}

.timeline-legend {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #4a5568;
}

.legend-color {
  width: 16px;
  height: 16px;
  border-radius: 50%;
}

.legend-color.active {
  background: #f8b195;
}

.legend-color.inactive {
  background: #8eb69b;
}

.timeline-scroll {
  overflow-x: auto;
  padding-bottom: 10px;
}

.timeline-year {
  margin-bottom: 30px;
}

.timeline-year-label {
  font-size: 18px;
  font-weight: 600;
  color: #2d3748;
  margin-bottom: 12px;
}

.timeline-months {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.timeline-month {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  font-size: 14px;
  font-weight: 500;
  cursor: default;
  transition: all 0.3s ease;
}

.timeline-month.active {
  background: #f8b195;
  color: white;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(248, 177, 149, 0.3);
}

.timeline-month.active:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 8px rgba(248, 177, 149, 0.4);
}

.timeline-month.inactive {
  background: #8eb69b;
  color: white;
  opacity: 0.6;
}

.month-number {
  pointer-events: none;
}

/* 弹窗样式 */
.timeline-modal-overlay,
.video-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.timeline-modal-content,
.video-modal-content {
  background: white;
  border-radius: 12px;
  max-width: 800px;
  width: 90%;
  max-height: 80vh;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.video-modal-content {
  max-width: 1000px;
}

.timeline-modal-header,
.video-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid #e2e8f0;
}

.timeline-modal-header h2,
.video-modal-header h3 {
  margin: 0;
  font-size: 20px;
  color: #2d3748;
  display: flex;
  align-items: center;
  gap: 8px;
}

.close-button {
  background: none;
  border: none;
  cursor: pointer;
  color: #718096;
  transition: color 0.3s ease;
}

.close-button:hover {
  color: #2d3748;
}

.timeline-modal-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  padding: 20px;
  background: #f7fafc;
  border-bottom: 1px solid #e2e8f0;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.stat-label {
  font-size: 14px;
  color: #718096;
}

.stat-value {
  font-size: 24px;
  font-weight: 600;
  color: #2d3748;
}

.stat-value.valid {
  color: #48bb78;
}

.stat-value.invalid {
  color: #f56565;
}

.timeline-modal-records {
  padding: 20px;
  max-height: 500px;
  overflow-y: auto;
}

.submission-record-card {
  display: flex;
  gap: 16px;
  padding: 16px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  margin-bottom: 12px;
  transition: all 0.3s ease;
}

.submission-record-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.record-cover {
  position: relative;
  width: 120px;
  height: 68px;
  flex-shrink: 0;
  border-radius: 6px;
  overflow: hidden;
  background: #edf2f7;
}

.record-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.cover-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #a0aec0;
}

.play-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.7);
  border: none;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.record-cover:hover .play-button {
  opacity: 1;
}

.record-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.record-title {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: #2d3748;
  line-height: 1.4;
}

.record-date {
  margin: 0;
  font-size: 14px;
  color: #718096;
}

.record-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  align-self: flex-start;
}

.record-badge.invalid {
  background: #fed7d7;
  color: #c53030;
}

.loading-container,
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
  color: #718096;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid #e2e8f0;
  border-top-color: #8eb69b;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.video-modal-body {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 比例 */
  height: 0;
  overflow: hidden;
}

.video-modal-body iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}

.inline-icon {
  display: inline-block;
  vertical-align: middle;
}
```

---

## 三、实现要点

### 3.1 数据加载策略
- **并行加载**：使用 `Promise.all` 并行加载所有年份的统计数据，提升加载速度
- **按需加载**：只有在用户点击月份时才加载该月的投稿记录
- **缓存策略**：利用浏览器缓存和后端缓存，减少重复请求

### 3.2 用户体验优化
- **加载状态**：显示加载动画和提示信息
- **错误处理**：友好的错误提示和重试机制
- **懒加载**：图片使用 `loading="lazy"` 属性
- **动画效果**：平滑的过渡动画和悬停效果

### 3.3 性能优化
- **组件优化**：使用 `useCallback` 和 `useMemo` 优化组件渲染
- **数据优化**：限制每页加载数量（100条）
- **代码分割**：使用 React.lazy 和 Suspense 实现代码分割

---

## 四、测试要点

### 4.1 功能测试
- [ ] 测试月度统计数据加载
- [ ] 测试月份点击交互
- [ ] 测试月度投稿记录加载
- [ ] 测试视频播放功能
- [ ] 测试分页功能

### 4.2 异常测试
- [ ] 测试网络错误处理
- [ ] 测试空数据处理
- [ ] 测试超时处理
- [ ] 测试边界条件（无投稿年份）

### 4.3 性能测试
- [ ] 测试大数据量加载性能
- [ ] 测试内存占用
- [ ] 测试渲染性能
- [ ] 测试缓存效果

---

## 五、部署检查清单

- [ ] 更新领域层类型定义
- [ ] 创建投稿服务接口
- [ ] 更新 API 类型定义
- [ ] 创建真实投稿服务实现
- [ ] 更新 TimelineChart 组件
- [ ] 添加组件样式文件
- [ ] 更新 SongsPage 导入
- [ ] 运行构建测试
- [ ] 功能测试
- [ ] 性能测试
- [ ] 代码审查
- [ ] 合并到主分支

---

## 六、后续优化方向

1. **虚拟滚动**：使用虚拟滚动优化大数据量列表渲染
2. **离线支持**：使用 Service Worker 实现离线访问
3. **数据预取**：预取用户可能查看的数据
4. **动画优化**：使用 CSS 动画替代 JavaScript 动画
5. **国际化**：支持多语言切换

---

## 七、总结

本前端实现方案提供了完整的"投稿时刻"功能前端支持，包括：

1. **类型定义**：完整的 TypeScript 类型定义
2. **服务接口**：符合 DDD 架构的服务接口定义
3. **真实实现**：对接后端 API 的真实服务实现
4. **组件更新**：更新 TimelineChart 组件使用真实数据
5. **样式优化**：完整的组件样式和动画效果

预计开发时间：2-3 天
预计测试时间：1 天
总计：3-4 天