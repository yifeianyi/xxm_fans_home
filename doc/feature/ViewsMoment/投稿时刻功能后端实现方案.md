# 投稿时刻功能 - 后端实现方案

## 一、实现概述

### 1.1 实现目标
基于现有的 `data_analytics` 应用，为"投稿时刻"功能提供完整的后端 API 支持，包括月度投稿统计、月度投稿记录和年度投稿概览等接口。

### 1.2 技术栈
- **框架**：Django 5.2.3 + Django REST Framework 3.15.2
- **数据库**：SQLite（view_data_db）
- **缓存**：Redis（可选）
- **工具库**：django-redis、django-filter

### 1.3 文件结构
```
repo/xxm_fans_backend/data_analytics/
├── models/
│   └── work_static.py                    # WorkStatic 模型（已存在）
├── api/
│   ├── views.py                          # API 视图（需新增）
│   ├── serializers.py                    # 序列化器（需新增）
│   └── filters.py                        # 过滤器（需新增）
├── urls.py                               # URL 配置（需更新）
└── services/
    └── submission_service.py             # 业务逻辑层（需新增）
```

---

## 二、实现步骤

### 2.1 创建序列化器（Serializers）

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/data_analytics/api/serializers.py`

```python
from rest_framework import serializers
from django.db.models import Count, Q, Min, Max
from data_analytics.models.work_static import WorkStatic


class MonthlySubmissionStatsSerializer(serializers.Serializer):
    """月度投稿统计序列化器"""
    month = serializers.IntegerField(min_value=1, max_value=12)
    total = serializers.IntegerField(min_value=0)
    valid = serializers.IntegerField(min_value=0)
    invalid = serializers.IntegerField(min_value=0)
    first_submission = serializers.DateTimeField()
    last_submission = serializers.DateTimeField()


class YearSummarySerializer(serializers.Serializer):
    """年度汇总统计序列化器"""
    total_submissions = serializers.IntegerField(min_value=0)
    valid_submissions = serializers.IntegerField(min_value=0)
    invalid_submissions = serializers.IntegerField(min_value=0)
    active_months = serializers.IntegerField(min_value=0)


class MonthlySubmissionStatsResponseSerializer(serializers.Serializer):
    """月度投稿统计响应序列化器"""
    year = serializers.IntegerField()
    platform = serializers.CharField(allow_null=True)
    monthly_stats = MonthlySubmissionStatsSerializer(many=True)
    year_summary = YearSummarySerializer()


class SubmissionRecordSerializer(serializers.ModelSerializer):
    """投稿记录序列化器"""
    cover_thumbnail_url = serializers.SerializerMethodField()
    video_url = serializers.SerializerMethodField()
    video_embed_url = serializers.SerializerMethodField()

    class Meta:
        model = WorkStatic
        fields = [
            'id', 'platform', 'work_id', 'title', 'author',
            'publish_time', 'cover_url', 'cover_thumbnail_url',
            'is_valid', 'video_url', 'video_embed_url'
        ]

    def get_cover_thumbnail_url(self, obj):
        """获取封面缩略图 URL"""
        if obj.cover_url:
            # 生成缩略图路径
            base_url = obj.cover_url.rsplit('/', 1)[0]
            filename = obj.cover_url.rsplit('/', 1)[1]
            thumb_filename = f"{filename.rsplit('.', 1)[0]}_thumb.{filename.rsplit('.', 1)[1]}"
            return f"{base_url}/thumbnails/{thumb_filename}"
        return None

    def get_video_url(self, obj):
        """生成视频播放 URL"""
        if obj.platform == 'bilibili':
            return f"https://www.bilibili.com/video/{obj.work_id}"
        elif obj.platform == 'youtube':
            return f"https://www.youtube.com/watch?v={obj.work_id}"
        return None

    def get_video_embed_url(self, obj):
        """生成视频嵌入 URL"""
        if obj.platform == 'bilibili':
            return f"https://player.bilibili.com/player.html?bvid={obj.work_id}"
        elif obj.platform == 'youtube':
            return f"https://www.youtube.com/embed/{obj.work_id}"
        return None


class MonthlySubmissionRecordsResponseSerializer(serializers.Serializer):
    """月度投稿记录响应序列化器"""
    year = serializers.IntegerField()
    month = serializers.IntegerField()
    platform = serializers.CharField(allow_null=True)
    records = SubmissionRecordSerializer(many=True)
    pagination = serializers.SerializerMethodField()

    def get_pagination(self, obj):
        """获取分页信息"""
        return {
            'total': obj.get('total', 0),
            'page': obj.get('page', 1),
            'page_size': obj.get('page_size', 20),
            'total_pages': obj.get('total_pages', 1)
        }


class YearStatsSerializer(serializers.Serializer):
    """年度统计序列化器"""
    year = serializers.IntegerField()
    total_submissions = serializers.IntegerField(min_value=0)
    valid_submissions = serializers.IntegerField(min_value=0)
    invalid_submissions = serializers.IntegerField(min_value=0)
    active_months = serializers.IntegerField(min_value=0)
    first_submission = serializers.DateTimeField()
    last_submission = serializers.DateTimeField()


class YearsSummarySerializer(serializers.Serializer):
    """年度汇总序列化器"""
    total_years = serializers.IntegerField(min_value=0)
    total_submissions = serializers.IntegerField(min_value=0)
    valid_submissions = serializers.IntegerField(min_value=0)
    invalid_submissions = serializers.IntegerField(min_value=0)


class YearsSubmissionOverviewResponseSerializer(serializers.Serializer):
    """年度投稿概览响应序列化器"""
    platform = serializers.CharField(allow_null=True)
    years = YearStatsSerializer(many=True)
    summary = YearsSummarySerializer()
```

---

### 2.2 创建业务逻辑层（Service）

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/data_analytics/services/submission_service.py`

```python
from django.db.models import Count, Q, Min, Max
from django.utils import timezone
from datetime import datetime
from data_analytics.models.work_static import WorkStatic


class SubmissionService:
    """投稿业务逻辑服务"""

    @staticmethod
    def get_monthly_submission_stats(year, platform=None):
        """
        获取月度投稿统计

        Args:
            year: 年份
            platform: 平台筛选（可选）

        Returns:
            dict: 月度统计数据
        """
        # 构建查询条件
        queryset = WorkStatic.objects.filter(
            publish_time__year=year
        )

        if platform:
            queryset = queryset.filter(platform=platform)

        # 按月聚合统计
        stats = queryset.values('publish_time__month').annotate(
            total=Count('id'),
            valid=Count('id', filter=Q(is_valid=True)),
            invalid=Count('id', filter=Q(is_valid=False)),
            first_submission=Min('publish_time'),
            last_submission=Max('publish_time')
        ).order_by('publish_time__month')

        # 转换为字典格式
        monthly_stats = []
        for stat in stats:
            monthly_stats.append({
                'month': stat['publish_time__month'],
                'total': stat['total'],
                'valid': stat['valid'],
                'invalid': stat['invalid'],
                'first_submission': stat['first_submission'],
                'last_submission': stat['last_submission']
            })

        # 计算年度汇总
        year_summary = {
            'total_submissions': queryset.count(),
            'valid_submissions': queryset.filter(is_valid=True).count(),
            'invalid_submissions': queryset.filter(is_valid=False).count(),
            'active_months': len(monthly_stats)
        }

        return {
            'year': year,
            'platform': platform,
            'monthly_stats': monthly_stats,
            'year_summary': year_summary
        }

    @staticmethod
    def get_monthly_submission_records(year, month, platform=None, is_valid=None, page=1, page_size=20):
        """
        获取月度投稿记录

        Args:
            year: 年份
            month: 月份
            platform: 平台筛选（可选）
            is_valid: 是否有效投稿（可选）
            page: 页码
            page_size: 每页数量

        Returns:
            dict: 月度投稿记录数据
        """
        # 构建查询条件
        queryset = WorkStatic.objects.filter(
            publish_time__year=year,
            publish_time__month=month
        )

        if platform:
            queryset = queryset.filter(platform=platform)

        if is_valid is not None:
            queryset = queryset.filter(is_valid=is_valid)

        # 获取总数
        total = queryset.count()

        # 计算分页
        page_size = min(page_size, 100)  # 限制最大每页数量
        offset = (page - 1) * page_size
        total_pages = (total + page_size - 1) // page_size

        # 分页查询
        records = queryset.order_by('publish_time')[offset:offset + page_size]

        return {
            'year': year,
            'month': month,
            'platform': platform,
            'records': records,
            'total': total,
            'page': page,
            'page_size': page_size,
            'total_pages': total_pages
        }

    @staticmethod
    def get_years_submission_overview(platform=None, start_year=None, end_year=None):
        """
        获取年度投稿概览

        Args:
            platform: 平台筛选（可选）
            start_year: 起始年份（可选，不传则自动从最早投稿年份开始）
            end_year: 结束年份（可选，不传则自动到当前年份）

        Returns:
            dict: 年度投稿概览数据
        """
        # 构建查询条件
        queryset = WorkStatic.objects.all()

        if platform:
            queryset = queryset.filter(platform=platform)

        # 如果没有指定年份范围，则自动确定
        if not start_year or not end_year:
            # 获取数据库中的最早和最晚投稿年份
            year_range = queryset.aggregate(
                min_year=Min('publish_time__year'),
                max_year=Max('publish_time__year')
            )
            if not start_year:
                start_year = year_range['min_year'] or timezone.now().year
            if not end_year:
                end_year = year_range['max_year'] or timezone.now().year

        # 应用年份范围筛选
        queryset = queryset.filter(
            publish_time__year__gte=start_year,
            publish_time__year__lte=end_year
        )

        # 按年聚合统计
        stats = queryset.values('publish_time__year').annotate(
            total_submissions=Count('id'),
            valid_submissions=Count('id', filter=Q(is_valid=True)),
            invalid_submissions=Count('id', filter=Q(is_valid=False)),
            active_months=Count('publish_time__month', distinct=True),
            first_submission=Min('publish_time'),
            last_submission=Max('publish_time')
        ).order_by('publish_time__year')

        # 转换为字典格式
        years = []
        for stat in stats:
            years.append({
                'year': stat['publish_time__year'],
                'total_submissions': stat['total_submissions'],
                'valid_submissions': stat['valid_submissions'],
                'invalid_submissions': stat['invalid_submissions'],
                'active_months': stat['active_months'],
                'first_submission': stat['first_submission'],
                'last_submission': stat['last_submission']
            })

        # 计算总体汇总
        summary = {
            'total_years': len(years),
            'total_submissions': queryset.count(),
            'valid_submissions': queryset.filter(is_valid=True).count(),
            'invalid_submissions': queryset.filter(is_valid=False).count()
        }

        return {
            'platform': platform,
            'years': years,
            'summary': summary
        }
```

---

### 2.3 创建 API 视图（Views）

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/data_analytics/api/views.py`

在现有文件中添加以下视图：

```python
from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework import status
from django.core.paginator import Paginator, EmptyPage
from core.responses import success_response, error_response
from data_analytics.services.submission_service import SubmissionService
from data_analytics.api.serializers import (
    MonthlySubmissionStatsResponseSerializer,
    MonthlySubmissionRecordsResponseSerializer,
    YearsSubmissionOverviewResponseSerializer
)


@api_view(['GET'])
def monthly_submission_stats(request):
    """
    获取月度投稿统计

    GET /api/data-analytics/submissions/monthly/?year=2024&platform=bilibili

    Args:
        year: 年份（默认当前年份）
        platform: 平台筛选（可选）

    Returns:
        JSON: 月度统计数据
    """
    try:
        # 获取查询参数
        year = request.query_params.get('year', timezone.now().year)
        platform = request.query_params.get('platform')

        # 参数验证
        try:
            year = int(year)
        except (ValueError, TypeError):
            return error_response(
                message="参数错误：年份必须为整数",
                code=status.HTTP_400_BAD_REQUEST
            )

        # 调用业务逻辑
        data = SubmissionService.get_monthly_submission_stats(year, platform)

        # 序列化响应
        serializer = MonthlySubmissionStatsResponseSerializer(data)
        return success_response(data=serializer.data)

    except Exception as e:
        return error_response(
            message=f"获取月度投稿统计失败：{str(e)}",
            code=status.HTTP_500_INTERNAL_SERVER_ERROR
        )


@api_view(['GET'])
def monthly_submission_records(request, year, month):
    """
    获取月度投稿记录

    GET /api/data-analytics/submissions/monthly/2024/1/?platform=bilibili&page=1&page_size=20

    Args:
        year: 年份（路径参数）
        month: 月份（路径参数）
        platform: 平台筛选（可选）
        is_valid: 是否有效投稿（可选）
        page: 页码（默认 1）
        page_size: 每页数量（默认 20）

    Returns:
        JSON: 月度投稿记录数据
    """
    try:
        # 获取查询参数
        platform = request.query_params.get('platform')
        is_valid = request.query_params.get('is_valid')
        page = int(request.query_params.get('page', 1))
        page_size = int(request.query_params.get('page_size', 20))

        # 参数验证
        if page < 1:
            return error_response(
                message="参数错误：页码必须大于 0",
                code=status.HTTP_400_BAD_REQUEST
            )

        if page_size < 1 or page_size > 100:
            return error_response(
                message="参数错误：每页数量必须在 1-100 之间",
                code=status.HTTP_400_BAD_REQUEST
            )

        # 处理 is_valid 参数
        if is_valid is not None:
            is_valid = is_valid.lower() in ['true', '1', 'yes']

        # 调用业务逻辑
        data = SubmissionService.get_monthly_submission_records(
            year, month, platform, is_valid, page, page_size
        )

        # 序列化响应
        serializer = MonthlySubmissionRecordsResponseSerializer(data)
        return success_response(data=serializer.data)

    except ValueError as e:
        return error_response(
            message=f"参数错误：{str(e)}",
            code=status.HTTP_400_BAD_REQUEST
        )
    except Exception as e:
        return error_response(
            message=f"获取月度投稿记录失败：{str(e)}",
            code=status.HTTP_500_INTERNAL_SERVER_ERROR
        )


@api_view(['GET'])
def years_submission_overview(request):
    """
    获取年度投稿概览

    GET /api/data-analytics/submissions/years/?platform=bilibili&start_year=2021&end_year=2024

    Args:
        platform: 平台筛选（可选）
        start_year: 起始年份（可选）
        end_year: 结束年份（可选）

    Returns:
        JSON: 年度投稿概览数据
    """
    try:
        # 获取查询参数
        platform = request.query_params.get('platform')
        start_year = request.query_params.get('start_year')
        end_year = request.query_params.get('end_year')

        # 参数验证
        if start_year is not None:
            try:
                start_year = int(start_year)
            except (ValueError, TypeError):
                return error_response(
                    message="参数错误：起始年份必须为整数",
                    code=status.HTTP_400_BAD_REQUEST
                )

        if end_year is not None:
            try:
                end_year = int(end_year)
            except (ValueError, TypeError):
                return error_response(
                    message="参数错误：结束年份必须为整数",
                    code=status.HTTP_400_BAD_REQUEST
                )

        # 调用业务逻辑
        data = SubmissionService.get_years_submission_overview(
            platform, start_year, end_year
        )

        # 序列化响应
        serializer = YearsSubmissionOverviewResponseSerializer(data)
        return success_response(data=serializer.data)

    except Exception as e:
        return error_response(
            message=f"获取年度投稿概览失败：{str(e)}",
            code=status.HTTP_500_INTERNAL_SERVER_ERROR
        )
```

---

### 2.4 更新 URL 配置

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/data_analytics/urls.py`

```python
from django.urls import path
from data_analytics.api.views import (
    # ... 现有导入
    monthly_submission_stats,
    monthly_submission_records,
    years_submission_overview
)

urlpatterns = [
    # ... 现有路由

    # 投稿时刻相关接口
    path('submissions/monthly/', monthly_submission_stats, name='monthly-submission-stats'),
    path('submissions/monthly/<int:year>/<int:month>/', monthly_submission_records, name='monthly-submission-records'),
    path('submissions/years/', years_submission_overview, name='years-submission-overview'),
]
```

---

### 2.5 添加缓存优化（可选）

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/data_analytics/services/submission_service.py`

在 `SubmissionService` 类中添加缓存方法：

```python
from django.core.cache import cache


class SubmissionService:
    """投稿业务逻辑服务"""

    CACHE_PREFIX = 'submission'
    CACHE_TIMEOUT_STATS = 3600  # 统计数据缓存 1 小时
    CACHE_TIMEOUT_RECORDS = 1800  # 记录数据缓存 30 分钟

    @staticmethod
    def _get_cache_key(prefix, *args):
        """生成缓存键"""
        return f"{SubmissionService.CACHE_PREFIX}:{prefix}:{':'.join(map(str, args))}"

    @staticmethod
    def get_monthly_submission_stats(year, platform=None):
        """
        获取月度投稿统计（带缓存）
        """
        # 生成缓存键
        cache_key = SubmissionService._get_cache_key('monthly_stats', year, platform or 'all')

        # 尝试从缓存获取
        cached_data = cache.get(cache_key)
        if cached_data:
            return cached_data

        # 构建查询条件
        queryset = WorkStatic.objects.filter(
            publish_time__year=year
        )

        if platform:
            queryset = queryset.filter(platform=platform)

        # 按月聚合统计
        stats = queryset.values('publish_time__month').annotate(
            total=Count('id'),
            valid=Count('id', filter=Q(is_valid=True)),
            invalid=Count('id', filter=Q(is_valid=False)),
            first_submission=Min('publish_time'),
            last_submission=Max('publish_time')
        ).order_by('publish_time__month')

        # 转换为字典格式
        monthly_stats = []
        for stat in stats:
            monthly_stats.append({
                'month': stat['publish_time__month'],
                'total': stat['total'],
                'valid': stat['valid'],
                'invalid': stat['invalid'],
                'first_submission': stat['first_submission'],
                'last_submission': stat['last_submission']
            })

        # 计算年度汇总
        year_summary = {
            'total_submissions': queryset.count(),
            'valid_submissions': queryset.filter(is_valid=True).count(),
            'invalid_submissions': queryset.filter(is_valid=False).count(),
            'active_months': len(monthly_stats)
        }

        result = {
            'year': year,
            'platform': platform,
            'monthly_stats': monthly_stats,
            'year_summary': year_summary
        }

        # 缓存结果
        cache.set(cache_key, result, SubmissionService.CACHE_TIMEOUT_STATS)

        return result

    @staticmethod
    def clear_monthly_stats_cache(year, platform=None):
        """清除月度统计缓存"""
        cache_key = SubmissionService._get_cache_key('monthly_stats', year, platform or 'all')
        cache.delete(cache_key)
```

---

## 三、数据库优化

### 3.1 索引优化

确保 `WorkStatic` 模型有以下索引：

```python
class WorkStatic(models.Model):
    # ... 现有字段

    class Meta:
        ordering = ['-publish_time']
        indexes = [
            models.Index(fields=['publish_time']),
            models.Index(fields=['platform', 'publish_time']),
            models.Index(fields=['is_valid', 'publish_time']),
        ]
```

### 3.2 创建迁移文件

```bash
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend
python manage.py makemigrations data_analytics
python manage.py migrate data_analytics
```

---

## 四、性能优化建议

### 4.1 查询优化
- 使用 `select_related` 和 `prefetch_related` 减少查询次数
- 使用 `only()` 和 `defer()` 限制查询字段
- 使用数据库连接池

### 4.2 缓存策略
- 统计数据缓存时间：1 小时
- 记录数据缓存时间：30 分钟
- 使用 Redis 作为缓存后端

### 4.3 分页优化
- 限制每页最大数量（100 条）
- 使用游标分页（Cursor Pagination）处理大数据量

---

## 五、错误处理

### 5.1 参数验证
- 年份必须为整数
- 月份必须在 1-12 之间
- 页码必须大于 0
- 每页数量必须在 1-100 之间

### 5.2 异常处理
- 数据库查询异常
- 序列化异常
- 缓存操作异常

### 5.3 日志记录
```python
import logging

logger = logging.getLogger(__name__)

@api_view(['GET'])
def monthly_submission_stats(request):
    try:
        # ... 业务逻辑
    except Exception as e:
        logger.error(f"获取月度投稿统计失败：{str(e)}", exc_info=True)
        return error_response(
            message=f"获取月度投稿统计失败：{str(e)}",
            code=status.HTTP_500_INTERNAL_SERVER_ERROR
        )
```

---

## 六、测试用例

### 6.1 单元测试

**文件路径**：`/home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend/data_analytics/tests/test_submission_api.py`

```python
from django.test import TestCase
from django.utils import timezone
from data_analytics.models.work_static import WorkStatic
from data_analytics.services.submission_service import SubmissionService
from rest_framework.test import APIClient


class SubmissionAPITestCase(TestCase):
    """投稿 API 测试"""

    def setUp(self):
        """创建测试数据"""
        # 创建测试投稿记录
        WorkStatic.objects.create(
            platform='bilibili',
            work_id='BV1234567890',
            title='测试作品1',
            author='测试作者',
            publish_time=timezone.make_aware(timezone.datetime(2024, 1, 5, 10, 30)),
            is_valid=True
        )
        WorkStatic.objects.create(
            platform='bilibili',
            work_id='BV0987654321',
            title='测试作品2',
            author='测试作者',
            publish_time=timezone.make_aware(timezone.datetime(2024, 1, 10, 14, 20)),
            is_valid=False
        )

    def test_monthly_submission_stats(self):
        """测试月度投稿统计接口"""
        client = APIClient()
        response = client.get('/api/data-analytics/submissions/monthly/?year=2024')

        self.assertEqual(response.status_code, 200)
        self.assertEqual(response.data['code'], 200)
        self.assertEqual(response.data['data']['year'], 2024)
        self.assertEqual(len(response.data['data']['monthly_stats']), 1)
        self.assertEqual(response.data['data']['monthly_stats'][0]['total'], 2)
        self.assertEqual(response.data['data']['monthly_stats'][0]['valid'], 1)
        self.assertEqual(response.data['data']['monthly_stats'][0]['invalid'], 1)

    def test_monthly_submission_records(self):
        """测试月度投稿记录接口"""
        client = APIClient()
        response = client.get('/api/data-analytics/submissions/monthly/2024/1/')

        self.assertEqual(response.status_code, 200)
        self.assertEqual(response.data['code'], 200)
        self.assertEqual(response.data['data']['year'], 2024)
        self.assertEqual(response.data['data']['month'], 1)
        self.assertEqual(len(response.data['data']['records']), 2)

    def test_years_submission_overview(self):
        """测试年度投稿概览接口"""
        client = APIClient()
        response = client.get('/api/data-analytics/submissions/years/')

        self.assertEqual(response.status_code, 200)
        self.assertEqual(response.data['code'], 200)
        self.assertEqual(len(response.data['data']['years']), 1)
        self.assertEqual(response.data['data']['years'][0]['year'], 2024)
```

### 6.2 运行测试

```bash
cd /home/yifeianyi/Desktop/xxm_fans_home/repo/xxm_fans_backend
python manage.py test data_analytics.tests.test_submission_api
```

---

## 七、部署检查清单

- [ ] 创建序列化器文件
- [ ] 创建业务逻辑服务文件
- [ ] 更新 API 视图文件
- [ ] 更新 URL 配置
- [ ] 创建数据库迁移文件
- [ ] 运行数据库迁移
- [ ] 编写单元测试
- [ ] 运行测试并验证
- [ ] 配置 Redis 缓存（可选）
- [ ] 更新 API 文档
- [ ] 代码审查
- [ ] 合并到主分支

---

## 八、后续优化方向

1. **异步处理**：使用 Celery 异步处理大数据量查询
2. **数据归档**：定期归档历史数据，提升查询性能
3. **监控告警**：添加接口性能监控和错误告警
4. **API 版本管理**：实现 API 版本控制
5. **限流保护**：添加访问频率限制

---

## 九、总结

本实现方案提供了完整的后端 API 支持，包括：

1. **序列化器**：定义了完整的数据序列化和反序列化逻辑
2. **业务逻辑层**：实现了投稿统计、记录查询等核心业务逻辑
3. **API 视图**：提供了 RESTful 风格的 API 接口
4. **缓存优化**：使用 Redis 缓存提升性能
5. **测试用例**：提供了完整的单元测试

预计开发时间：2-3 天
预计测试时间：1 天
总计：3-4 天