# 原唱歌曲播放功能实现方案

## 一、现状分析

### 1.1 当前实现

**前端组件**: `OriginalsList.tsx` + `MusicPlayer.tsx`

**播放方式**: 
- 使用网易云音乐外链播放器（iframe 嵌入）
- 播放器 URL 格式: `//music.163.com/outchain/player?type=2&id={songId}&auto=1&height=32`
- `songId` 为网易云音乐的歌曲 ID

**数据结构**:
```typescript
interface OriginalWork {
  title: string;
  date: string;
  desc: string;
  cover: string;
  songId: string;        // 网易云音乐歌曲 ID
  featured: boolean;
}
```

### 1.2 存在的问题

1. **平台限制**: 网易云音乐外链播放器只能播放网易云音乐平台上的歌曲
2. **数据不完整**: 部分原唱歌曲可能在其他平台（如 B站视频等）
3. **用户体验**: 需要跳转到不同平台才能完整收听所有作品
4. **灵活性**: 缺少对暂无播放链接的歌曲的支持

### 1.3 实际情况

根据描述，咻咻满的原唱歌曲：
- **大部分** 在网易云音乐上（可使用外链播放）
- **少部分** 在 B站以视频形式发布
- **部分** 暂时没有公开的播放链接

---

## 二、解决方案设计

### 2.1 设计目标

1. **灵活性**: 支持多种播放方式（网易云音乐、B站视频）
2. **完整性**: 支持暂无播放链接的歌曲展示
3. **智能化**: 根据录入信息自动选择合适的播放方式
4. **简洁性**: 无需用户手动选择，自动适配

### 2.2 三种播放方式

#### 方式一：网易云音乐外链播放器

**适用情况**: 歌曲已发布在网易云音乐平台

**数据要求**: 需要提供网易云音乐歌曲 ID

#### 方式二：B站视频播放器

**适用情况**: 歌曲以视频形式发布在 B站

**数据要求**: 需要提供 B站视频 BV 号

#### 方式三：暂无播放链接

**适用情况**: 歌曲尚未公开发布或暂时没有可用的播放链接

**数据要求**: 无需额外数据

### 2.3 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                     OriginalsList 组件                        │
│                    (原唱作品列表展示)                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              智能播放控制器 (SmartPlayController)              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  1. 检测歌曲播放信息                                 │   │
│  │  2. 自动选择播放方式                               │   │
│  │     - 有 neteaseId → 网易云播放器                   │   │
│  │     - 有 bilibiliBvid → B站播放器                   │   │
│  │     - 都没有 → 显示暂无链接提示                     │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 三、数据模型设计

### 3.1 扩展 OriginalWork 接口

```typescript
export interface OriginalWork {
  title: string;
  date: string;
  desc: string;
  cover: string;
  neteaseId?: string;       // 网易云音乐歌曲 ID（可选）
  bilibiliBvid?: string;    // B站视频 BV 号（可选）
  featured: boolean;
}
```

### 3.2 播放方式判断逻辑

```typescript
type PlayMode = 'netease' | 'bilibili' | 'none';

const getPlayMode = (work: OriginalWork): PlayMode => {
  if (work.neteaseId) {
    return 'netease';
  }
  if (work.bilibiliBvid) {
    return 'bilibili';
  }
  return 'none';
};
```

---

## 四、技术实现

### 4.1 组件结构

```
presentation/components/common/
├── MusicPlayer.tsx              # 网易云音乐播放器（已有）
├── VideoModal.tsx               # 视频播放模态框（已有）
└── SmartPlayController.tsx      # 智能播放控制器（新增）

shared/services/
└── VideoPlayerService.ts        # 视频播放服务（已有，支持 Bilibili、YouTube）
```

### 4.2 现有组件复用

本方案复用项目中已有的三个组件：

- **MusicPlayer** - 网易云音乐播放器（`presentation/components/common/MusicPlayer.tsx`）
- **VideoModal** - 视频播放模态框（`presentation/components/common/VideoModal.tsx`）
- **VideoPlayerService** - 视频播放服务（`shared/services/VideoPlayerService.ts`）

这些组件已经在项目中使用，无需修改，直接复用即可。

### 4.3 智能播放控制器（新增）

**文件位置**: `presentation/components/common/SmartPlayController.tsx`

**核心逻辑**:
```typescript
import React, { useEffect, useState } from 'react';
import MusicPlayer from './MusicPlayer';
import VideoModal from './VideoModal';
import { OriginalWork } from '../../../domain/types';

interface SmartPlayControllerProps {
  work: OriginalWork | null;
  onClose: () => void;
}

const SmartPlayController: React.FC<SmartPlayControllerProps> = ({ work, onClose }) => {
  if (!work) return null;

  // 优先使用网易云音乐
  if (work.neteaseId) {
    return <MusicPlayer songId={work.neteaseId} onClose={onClose} />;
  }

  // 其次使用 B站视频
  if (work.bilibiliBvid) {
    const videoUrl = `https://www.bilibili.com/video/${work.bilibiliBvid}`;
    return <VideoModal videoUrl={videoUrl} onClose={onClose} />;
  }

  // 暂无播放链接
  return null;
};

export default SmartPlayController;
```

### 4.4 OriginalsList 组件修改

```typescript
// 引入智能播放控制器
import SmartPlayController from '../common/SmartPlayController';

// 修改状态管理
const [currentWork, setCurrentWork] = useState<OriginalWork | null>(null);

// 替换原来的 MusicPlayer
<SmartPlayController work={currentWork} onClose={() => setCurrentWork(null)} />

// 添加暂无链接提示
const handleWorkClick = (work: OriginalWork) => {
  if (!work.neteaseId && !work.bilibiliBvid) {
    alert('该歌曲暂无播放链接，敬请期待！');
    return;
  }
  setCurrentWork(work);
};
```

---

## 五、数据示例

### 5.1 Mock 数据

```typescript
const MOCK_ORIGINAL_WORKS: OriginalWork[] = [
  {
    title: '满天星',
    date: '2024.01.15',
    desc: '第一首个人原创单曲，星光点缀梦境。',
    cover: 'https://picsum.photos/seed/o1/400/400',
    neteaseId: '1330348068',
    featured: true
  },
  {
    title: '溯光者',
    date: '2023.11.20',
    desc: '在音符中寻找光亮，致敬不曾放弃的灵魂。',
    cover: 'https://picsum.photos/seed/o2/400/400',
    bilibiliBvid: 'BV1xx411c7mD',
    featured: true
  },
  {
    title: '未发布作品',
    date: '2025.03.01',
    desc: '即将发布的全新原唱作品，敬请期待！',
    cover: 'https://picsum.photos/seed/o4/400/400',
    featured: false
  }
];
```

### 5.2 播放方式示例

| 歌曲 | neteaseId | bilibiliBvid | 播放方式 | 使用的组件 |
|------|-----------|--------------|---------|-----------|
| 满天星 | 1330348068 | - | 网易云播放器 | MusicPlayer |
| 溯光者 | - | BV1xx411c7mD | B站视频播放器 | VideoModal |
| 未发布作品 | - | - | 暂无链接提示 | - |

---

## 六、实施步骤

### 阶段一：扩展数据模型

1. **更新 `domain/types.ts`**
   - 扩展 `OriginalWork` 接口
   - 添加 `neteaseId` 和 `bilibiliBvid` 字段

2. **更新 Mock 数据**
   - 为每首歌曲添加播放信息
   - 测试三种播放方式

### 阶段二：创建智能播放控制器

创建 `SmartPlayController.tsx` 组件，根据歌曲数据自动选择播放方式。

### 阶段三：更新 OriginalsList 组件

1. 替换 MusicPlayer 为 SmartPlayController
2. 更新状态管理（从 `currentSongId` 改为 `currentWork`）
3. 添加暂无链接提示

### 阶段四：测试和优化

1. **功能测试**
   - 测试网易云音乐播放
   - 测试 B站视频播放
   - 测试暂无链接提示
   - 测试优先级策略

2. **UI/UX 优化**
   - 优化播放器样式（使用现有样式）
   - 添加加载状态
   - 优化动画效果

---

## 七、优势分析

### 7.1 灵活性优势
- ✅ 支持网易云音乐播放
- ✅ 支持 B站视频播放
- ✅ 支持暂无链接展示
- ✅ 易于扩展新的播放方式（YouTube、Vimeo 等）

### 7.2 用户体验优势
- ✅ 自动选择播放方式，无需用户手动选择
- ✅ 内嵌播放，无需跳转
- ✅ 统一的 UI 设计（复用现有组件）
- ✅ 智能降级，友好的提示

### 7.3 开发维护优势
- ✅ 复用现有组件，减少重复代码
- ✅ 代码结构清晰
- ✅ 易于理解和维护
- ✅ 数据模型可扩展
- ✅ 向后兼容

### 7.4 成本优势
- ✅ 无需创建新的播放器组件
- ✅ 无需额外的依赖
- ✅ 降低开发和维护成本
- ✅ 快速实现功能

---

## 八、注意事项

### 8.1 平台限制

1. **网易云音乐外链播放器**
   - 需要确保歌曲 ID 正确
   - 部分歌曲可能因版权无法播放
   - 外链播放器功能有限

2. **B站视频播放器**
   - 需要确保 BV 号正确
   - 部分视频可能有地区限制
   - 视频加载速度可能较慢

### 8.2 优先级策略

**当前策略**: 网易云 > B站 > 暂无

**原因**:
- 网易云音乐是专业音乐平台，音质更好
- B站视频可能包含额外内容（如访谈、MV 等）
- 优先选择纯音频体验

**可调整**: 根据实际需求调整优先级

### 8.3 版权和合规

1. **原创版权**: 确保所有歌曲都是原唱作品
2. **平台规则**: 遵守各平台的使用条款
3. **合规发布**: 确保在平台的发布符合相关规定

---

## 九、总结

### 9.1 方案特点

本方案通过**智能播放控制器**实现了对三种播放方式的支持：

1. **网易云音乐外链播放器** - 适合纯音频播放
2. **B站视频播放器** - 适合视频内容
3. **暂无链接提示** - 适合未发布作品

### 9.2 核心优势

- ✅ 复用现有组件，降低开发成本
- ✅ 灵活性强，支持多种播放方式
- ✅ 智能选择，无需用户手动操作
- ✅ 用户体验好，内嵌播放无需跳转
- ✅ 实现简单，代码结构清晰
- ✅ 易于扩展，可添加新的播放方式
- ✅ 保持统一的设计风格

### 9.3 适用场景

本方案适用于以下情况：
- 原唱歌曲分布在多个平台
- 部分歌曲以视频形式发布
- 部分歌曲暂未公开发布
- 需要灵活的播放方式支持
- 希望快速实现功能，降低开发成本

### 9.4 技术亮点

- **组件复用**: 充分利用项目中已有的 VideoPlayerService 和 VideoModal 组件
- **智能适配**: 根据数据自动选择最佳的播放方式
- **优先级策略**: 合理的播放优先级，优先提供纯音频体验
- **可扩展性**: 易于添加新的播放平台支持

这是一个平衡灵活性、用户体验、开发成本和代码质量的优秀方案。