# 小满虫之家项目 TODO 清单

> 可执行、可检查、可追踪的任务清单

---

## 📋 任务状态图例

- [ ] 未开始
- [~] 进行中
- [x] 已完成
- [!] 阻塞/有问题

---

## 第一阶段：项目文档完善（建议 1 周内完成）

### 1.1 架构文档补充

- [ ] **绘制完整架构图**
  - [ ] 使用 draw.io 或 Excalidraw 绘制彩色架构图
  - [ ] 包含：网络层、服务层、数据层
  - [ ] 输出：PNG/SVG 图片放入 doc/architecture/images/
  - [ ] 在 README.md 中引用

- [ ] **补充部署流程文档**
  - [ ] 编写 doc/operations/部署手册.md
  - [ ] 包含：从零部署到服务器的完整步骤
  - [ ] 包含：常见问题排查（FAQ）
  - [ ] 包含：备份和恢复流程

- [ ] **编写 API 接口文档**
  - [ ] 整理所有 API 端点列表
  - [ ] 使用 Swagger/OpenAPI 格式
  - [ ] 或制作表格：接口、方法、参数、返回值

### 1.2 代码注释补充

- [ ] **后端核心模块添加 docstring**
  ```python
  # 目标文件清单：
  - [ ] song_management/models/song.py
  - [ ] song_management/api/song_views.py
  - [ ] song_management/services/song_service.py
  - [ ] gallery/models.py
  - [ ] livestream/models.py
  ```

- [ ] **前端复杂函数添加注释**
  ```typescript
  // 目标文件清单：
  - [ ] RealSongService.ts 中的数据转换函数
  - [ ] SongTable.tsx 中的复杂 useEffect
  - [ ] GalleryPage.tsx 中的递归渲染逻辑
  ```

---

## 第二阶段：源码掌握（第 1-2 周）

### 2.1 建立项目认知

- [ ] **绘制项目结构图**
  - [ ] 手写后端目录结构（A4 纸拍照存档）
  - [ ] 手写前端目录结构（A4 纸拍照存档）
  - [ ] 标记每个目录的作用

- [ ] **建立文件索引表**
  - [ ] 创建 doc/INDEX.md
  - [ ] 表格：功能描述 → 后端文件 → 前端文件
  - [ ] 示例：
    | 功能 | 后端 | 前端 |
    |-----|------|-----|
    | 歌曲列表 | song_views.py | SongsPage.tsx |

- [ ] **跟踪一个完整请求**
  - [ ] 选择：歌曲列表加载
  - [ ] 用 debugger 跟踪从 URL 到数据库的全过程
  - [ ] 记录调用栈（函数调用链）
  - [ ] 输出：调用流程图

### 2.2 后端源码精读

- [ ] **读懂 Song 模型**
  - [ ] 阅读：song_management/models/song.py
  - [ ] 任务：给每个字段添加注释（为什么这样设计）
  - [ ] 任务：画出 Song 和 SongRecord 的关系图
  - [ ] 验证：在 shell 中创建、查询、删除数据

- [ ] **读懂 Gallery 模型**
  - [ ] 阅读：gallery/models.py
  - [ ] 任务：理解自引用外键（parent/children）
  - [ ] 任务：画出三级图集的数据关系
  - [ ] 验证：创建测试数据，验证层级计算

- [ ] **理解 DRF 视图**
  - [ ] 阅读：song_management/api/song_views.py
  - [ ] 任务：对比 APIView vs ModelViewSet
  - [ ] 任务：列出项目中使用的所有 DRF 特性
  - [ ] 验证：修改一个 API 的返回字段

- [ ] **理解序列化器**
  - [ ] 阅读：song_management/api/serializers.py
  - [ ] 任务：理解嵌套序列化器（SongWithRecordsSerializer）
  - [ ] 任务：手动序列化一个对象对比

### 2.3 前端源码精读

- [ ] **读懂类型定义**
  - [ ] 阅读：domain/types.ts
  - [ ] 任务：对比前后端字段命名（snake_case vs camelCase）
  - [ ] 任务：找出所有接口类型

- [ ] **读懂 SWR 数据获取**
  - [ ] 阅读：infrastructure/hooks/useData.ts
  - [ ] 任务：对比 SWR vs 普通 fetch
  - [ ] 任务：分析缓存策略（key 的作用）

- [ ] **读懂组件生命周期**
  - [ ] 选择：SongsPage.tsx
  - [ ] 任务：添加 console.log 观察执行顺序
  - [ ] 任务：画出组件生命周期图

---

## 第三阶段：实战练习（第 3-4 周）

### 3.1 后端修改练习

- [ ] **练习 1：添加字段**
  - [ ] 给 Song 添加 `difficulty` 字段（演唱难度 1-10）
  - [ ] 生成并执行 migration
  - [ ] 更新 serializer
  - [ ] 在 admin 中可编辑
  - [ ] 验证：API 返回包含新字段

- [ ] **练习 2：自定义 API**
  - [ ] 创建随机推荐 API（/api/random-song/）
  - [ ] 实现随机选择逻辑
  - [ ] 添加 URL 路由
  - [ ] 用 curl/Postman 测试
  - [ ] 前端调用测试

- [ ] **练习 3：复杂查询**
  - [ ] 实现"按演唱次数范围筛选"功能
  - [ ] 后端：修改 filter 逻辑
  - [ ] 前端：添加筛选 UI

### 3.2 前端修改练习

- [ ] **练习 4：添加页面**
  - [ ] 创建 TestPage.tsx
  - [ ] 添加路由 /test
  - [ ] 添加到导航栏
  - [ ] 实现简单功能（如计数器）

- [ ] **练习 5：组件修改**
  - [ ] 修改 SongTable，添加"难度"列显示
  - [ ] 实现排序功能（点击表头排序）

- [ ] **练习 6：状态管理**
  - [ ] 实现一个简单的全局状态（如主题切换）
  - [ ] 使用 Context 或状态提升

### 3.3 完整功能开发

- [ ] **实战：歌曲收藏功能**
  - [ ] **后端**
    - [ ] 添加 `is_favorite` 字段到 Song
    - [ ] 创建 toggle-favorite API
    - [ ] 测试 API
  - [ ] **前端**
    - [ ] 更新 Song 类型
    - [ ] 添加收藏按钮组件
    - [ ] 实现点击切换
    - [ ] 添加到歌曲列表页
  - [ ] **验证**
    - [ ] 功能测试
    - [ ] 刷新后状态保持
    - [ ] 多端同步测试

---

## 第四阶段：调试能力（第 5 周）

### 4.1 后端调试

- [ ] **掌握 Django Shell**
  - [ ] 练习：批量查询和修改数据
  - [ ] 练习：测试复杂 ORM 查询
  - [ ] 练习：查看 SQL 执行计划

- [ ] **掌握 pdb 调试**
  - [ ] 在 API 中添加断点
  - [ ] 练习：单步执行、查看变量
  - [ ] 练习：条件断点

- [ ] **日志分析**
  - [ ] 查看 logs/django.log
  - [ ] 配置 SQL 日志输出
  - [ ] 分析慢查询

### 4.2 前端调试

- [ ] **Chrome DevTools**
  - [ ] Network 面板：分析 API 请求
  - [ ] Console 面板：查看错误信息
  - [ ] Sources 面板：断点调试
  - [ ] React DevTools：查看组件树

- [ ] **性能分析**
  - [ ] 使用 Profiler 分析组件渲染
  - [ ] 找出不必要的重渲染
  - [ ] 优化 useEffect 依赖

---

## 第五阶段：源码深度理解（持续）

### 5.1 专项深入

- [ ] **深入理解 Gallery 树形结构**
  - [ ] 阅读所有 Gallery 相关代码
  - [ ] 画出完整的类图
  - [ ] 理解：
    - [ ] 如何防止循环引用
    - [ ] 如何统计图片数量
    - [ ] 缩略图生成原理

- [ ] **深入理解爬虫系统**
  - [ ] 阅读 spider/run_tiered_crawler.py
  - [ ] 理解热数据/冷数据策略
  - [ ] 画出爬虫执行流程图

- [ ] **深入理解部署配置**
  - [ ] 阅读 infra/nginx/*.conf
  - [ ] 理解每个 location 的作用
  - [ ] 理解 systemd 服务配置

### 5.2 代码重构

- [ ] **重构机会识别**
  - [ ] 找出代码中的重复逻辑
  - [ ] 提取公共函数
  - [ ] 优化性能瓶颈

---

## 第六阶段：文档维护（持续）

### 6.1 更新现有文档

- [ ] **架构图更新**
  - [ ] 项目结构变化时同步更新
  - [ ] 添加新的模块说明

- [ ] **API 文档更新**
  - [ ] 新增接口时添加文档
  - [ ] 修改接口时更新文档

### 6.2 新增文档

- [ ] **开发规范文档**
  - [ ] 代码风格规范
  - [ ] Git 提交规范
  - [ ] PR 规范

- [ ] **问题排查手册**
  - [ ] 常见问题及解决方案
  - [ ] 错误码说明
  - [ ] 性能优化指南

---

## 📊 进度追踪表

| 周次 | 主要目标 | 关键成果 | 完成度 |
|-----|---------|---------|-------|
| 第1周 | 读懂项目骨架 | 手绘架构图、文件索引表 | [ ] 0% |
| 第2周 | 掌握后端核心 | 能独立改 Model、加 API | [ ] 0% |
| 第3周 | 掌握前端核心 | 能独立加页面、改组件 | [ ] 0% |
| 第4周 | 完整功能开发 | 收藏功能上线 | [ ] 0% |
| 第5周 | 调试能力 | 能快速定位问题 | [ ] 0% |
| 第6周+ | 深度理解 | 能解释所有设计决策 | [ ] 0% |

---

## 🎯 每日检查清单

### 每天开始
- [ ] 回顾昨天学了什么
- [ ] 确定今天的具体目标
- [ ] 准备好调试环境

### 每天结束
- [ ] 总结今天学到的知识点
- [ ] 记录遇到的问题
- [ ] 更新 TODO 状态
- [ ] 规划明天任务

---

## 📝 学习笔记模板

```markdown
## 日期：202X-XX-XX

### 今日任务
- [x] 任务1
- [~] 任务2

### 学到的知识点
1. XXX
2. YYY

### 遇到的问题
- 问题：...
- 解决：...

### 代码片段
```python
# 记录重要的代码片段
```

### 明日计划
- [ ] 任务A
- [ ] 任务B
```

---

## ✅ 完成标准

完成本 TODO 后，你应该能够：

### 必须达到
- [ ] 不借助 AI，独立读懂任意项目文件的代码
- [ ] 能独立添加一个完整功能（如收藏功能）
- [ ] 能快速定位并修复简单 Bug
- [ ] 能向他人解释项目架构

### 进阶目标
- [ ] 能重构现有代码，提升可维护性
- [ ] 能优化性能瓶颈
- [ ] 能设计新功能的数据库结构
- [ ] 能 Code Review 他人的代码

---

## 📌 优先级说明

**P0（最高）**：必须完成，阻塞后续任务
**P1（高）**：重要任务，建议本周完成
**P2（中）**：有价值，有空时完成
**P3（低）**：锦上添花，长期积累

当前 P0 任务：
1. 绘制项目结构图
2. 读懂 Song 模型
3. 完成收藏功能实战

---

*最后更新：202X-XX-XX*
*更新人：你的名字*
